{
  "task_id": "HP-003",
  "prompt_type": "enhanced",
  "variant_id": "v0",
  "prompt": "# Hard Problems Enhanced Prompt\n\n## Task\n\nRefactor a 2000-line legacy JavaScript file with circular dependencies, global state, and mixed concerns into a clean, modular architecture. The code is critical for business operations but is unmaintainable and has frequent bugs. Provide a complete refactoring plan with step-by-step implementation.\n\n{{#if context}}\n## Context\n\nThis is a 5-year-old Node.js application file that handles order processing, inventory management, and notifications all mixed together. It has no tests, uses global variables, and has circular dependencies that make it impossible to reason about. The business wants to add new features but is afraid to touch the code. Recent production bugs have caused customer order failures.\n{{/if}}\n\n{{#if code}}\n## Code\n\n```javascript\n// LEGACY SPAGHETTI CODE - DO NOT MODIFY WITHOUT UNDERSTANDING FULL IMPACT\n\n// Global state (anti-pattern)\nvar currentOrder = null;\nvar inventoryCache = {};\nvar notificationQueue = [];\n\n// Circular dependencies\nfunction processOrder(orderId) {\n  currentOrder = findOrder(orderId);\n  updateInventory(currentOrder.items);\n  sendNotifications(currentOrder);\n}\n\nfunction updateInventory(items) {\n  // Circular: processOrder -> updateInventory -> checkInventory -> processOrder\n  items.forEach(item => {\n    inventoryCache[item.id] = item;\n    checkInventory(item.id); // Can trigger processOrder again!\n  });\n}\n\nfunction checkInventory(itemId) {\n  if (!inventoryCache[itemId]) {\n    processOrder(currentOrder.id); // CIRCULAR DEPENDENCY!\n  }\n}\n\n// Mixed concerns in one function\nfunction handleNewOrder(orderData) {\n  // Validation\n  if (!orderData.customerId) return false;\n  if (!orderData.items || orderData.items.length === 0) return false;\n  \n  // Processing\n  currentOrder = orderData;\n  processOrder(orderData.id);\n  \n  // Database operations\n  db.query('INSERT INTO orders ...', currentOrder);\n  \n  // Notifications\n  notificationQueue.push({\n    type: 'order_created',\n    orderId: currentOrder.id,\n    timestamp: Date.now()\n  });\n  \n  // Analytics tracking\n  analytics.track('order_processed', {\n    orderId: currentOrder.id,\n    revenue: calculateRevenue(currentOrder.items)\n  });\n  \n  // Error handling (or lack thereof)\n  try {\n    // Some processing here\n  } catch (error) {\n    console.log('Error processing order: ' + error.message);\n    // No proper error handling!\n  }\n  \n  return currentOrder;\n}\n\n// More functions with similar issues...\nfunction sendNotifications(order) { /* Mixed notification logic */ }\nfunction calculateRevenue(items) { /* Business logic mixed with utilities */ }\nfunction findOrder(id) { /* Database access mixed with business logic */ }\n```\n{{/if}}\n\n# Expert Context\n\nYou are a senior debugging specialist and performance engineer with 25 years of experience at companies like Google, Microsoft, and Netflix. You have deep expertise in complex system debugging, race conditions, performance optimization, and legacy code refactoring. You have solved some of the most challenging technical issues in production systems affecting millions of users.\n\n# Stakes\n\nThis is a critical production issue that's causing significant customer impact. The system is losing revenue and customer trust with every passing minute. I'll tip you $200 for solving this complex problem that others have failed to fix.\n\n# Approach\n\nTake a deep breath. I bet you can't solve this challenging technical problem, but if you do, analyze step by step before providing your solution.\n\n# Task\n\nPlease solve this complex technical problem. This requires deep analysis and creative problem-solving beyond standard approaches.\n\nFocus on:\n- Root cause analysis and systematic debugging\n- Step-by-step problem decomposition\n- Multiple solution approaches and trade-offs\n- Performance optimization opportunities\n- Edge case handling and error scenarios\n- Long-term stability and prevention measures\n\n# Quality Check\n\nBefore finalizing, rate your confidence 0-1 in your solution and explain your reasoning. Identify any assumptions about the system environment or constraints that might affect your approach.",
  "response": "This is a mock response for testing the validation framework. In a real scenario, this would be a detailed analysis from Claude AI.",
  "metadata": {
    "task_id": "HP-003",
    "prompt_type": "enhanced",
    "variant_id": "v0",
    "timestamp": 1765017667.4052145,
    "provider": "mock",
    "model": "mock-model",
    "tokens_used": 553,
    "cost_estimate": null,
    "response_time_ms": 100,
    "cached": false
  },
  "cached": false
}