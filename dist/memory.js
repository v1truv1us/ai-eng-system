// src/context/memory.ts
import { existsSync } from "node:fs";
import { mkdir, readFile, writeFile } from "node:fs/promises";
import { join } from "node:path";

// src/context/types.ts
var DEFAULT_CONFIG = {
  storagePath: ".ai-context",
  maxMemoriesPerType: 100,
  sessionArchiveDays: 30,
  confidenceDecayRate: 0.05,
  enableEmbeddings: false,
  defaultSkillTier: 1,
  enableAutoInference: true,
  export: {
    enabled: false,
    markdown: {
      outputDir: ".ai-context/exports"
    }
  }
};

// src/context/memory.ts
class MemoryManager {
  config;
  memoryDir;
  store = {
    declarative: [],
    procedural: [],
    episodic: []
  };
  constructor(config = {}) {
    this.config = { ...DEFAULT_CONFIG, ...config };
    this.memoryDir = join(this.config.storagePath, "memory");
  }
  async initialize() {
    await mkdir(this.memoryDir, { recursive: true });
    await this.loadMemories();
  }
  async loadMemories() {
    const types = ["declarative", "procedural", "episodic"];
    for (const type of types) {
      const path = join(this.memoryDir, `${type}.json`);
      if (existsSync(path)) {
        try {
          const content = await readFile(path, "utf-8");
          this.store[type] = JSON.parse(content);
          this.store[type] = this.store[type].map((entry) => this.applyConfidenceDecay(entry));
        } catch (error) {
          console.error(`Failed to load ${type} memories:`, error);
        }
      }
    }
  }
  async saveMemories() {
    const types = ["declarative", "procedural", "episodic"];
    for (const type of types) {
      const path = join(this.memoryDir, `${type}.json`);
      await writeFile(path, JSON.stringify(this.store[type], null, 2));
    }
  }
  async addMemory(type, content, options) {
    const now = new Date().toISOString();
    const entry = {
      id: `mem_${Date.now().toString(36)}_${Math.random().toString(36).substring(2, 8)}`,
      type,
      content,
      provenance: {
        source: options?.source || "user",
        timestamp: now,
        confidence: options?.confidence ?? (options?.source === "inferred" ? 0.7 : 1),
        context: options?.context || "",
        sessionId: options?.sessionId
      },
      tags: options?.tags || [],
      lastAccessed: now,
      accessCount: 0
    };
    this.store[type].push(entry);
    if (this.store[type].length > this.config.maxMemoriesPerType) {
      this.store[type].sort((a, b) => {
        const scoreA = a.accessCount / (Date.now() - new Date(a.lastAccessed).getTime());
        const scoreB = b.accessCount / (Date.now() - new Date(b.lastAccessed).getTime());
        return scoreA - scoreB;
      });
      this.store[type] = this.store[type].slice(-this.config.maxMemoriesPerType);
    }
    await this.saveMemories();
    return entry;
  }
  async updateMemory(id, updates) {
    for (const type of Object.keys(this.store)) {
      const entry = this.store[type].find((e) => e.id === id);
      if (entry) {
        Object.assign(entry, updates);
        entry.lastAccessed = new Date().toISOString();
        await this.saveMemories();
        return entry;
      }
    }
    return null;
  }
  async accessMemory(id) {
    for (const type of Object.keys(this.store)) {
      const entry = this.store[type].find((e) => e.id === id);
      if (entry) {
        entry.lastAccessed = new Date().toISOString();
        entry.accessCount++;
        await this.saveMemories();
        return entry;
      }
    }
    return null;
  }
  async deleteMemory(id) {
    for (const type of Object.keys(this.store)) {
      const index = this.store[type].findIndex((e) => e.id === id);
      if (index > -1) {
        this.store[type].splice(index, 1);
        await this.saveMemories();
        return true;
      }
    }
    return false;
  }
  async storeCommandEnvelope(envelope, options) {
    return this.addMemory("episodic", JSON.stringify(envelope, null, 2), {
      source: options?.source ?? "agent",
      confidence: options?.confidence ?? 1,
      context: options?.context ?? `Command envelope: ${envelope.commandName}`,
      sessionId: envelope.sessionId,
      tags: envelope.tags
    });
  }
  getLatestCommandEnvelope(filter) {
    const episodic = this.getMemoriesByType("episodic");
    const candidates = episodic.filter((entry) => entry.tags.includes("command-envelope")).filter((entry) => filter?.commandName ? entry.tags.includes(`command:${filter.commandName}`) : true).filter((entry) => filter?.sessionId ? entry.provenance.sessionId === filter.sessionId : true).sort((a, b) => new Date(b.provenance.timestamp).getTime() - new Date(a.provenance.timestamp).getTime());
    const latest = candidates[0];
    if (!latest)
      return null;
    try {
      return JSON.parse(latest.content);
    } catch {
      return null;
    }
  }
  searchMemories(query, options) {
    const queryLower = query.toLowerCase();
    const results = [];
    const types = options?.type ? [options.type] : Object.keys(this.store);
    for (const type of types) {
      results.push(...this.store[type].filter((entry) => {
        if (!entry.content.toLowerCase().includes(queryLower)) {
          return false;
        }
        if (options?.tags && options.tags.length > 0) {
          if (!options.tags.some((tag) => entry.tags.includes(tag))) {
            return false;
          }
        }
        if (options?.minConfidence && entry.provenance.confidence < options.minConfidence) {
          return false;
        }
        return true;
      }));
    }
    results.sort((a, b) => {
      const scoreA = a.accessCount * a.provenance.confidence;
      const scoreB = b.accessCount * b.provenance.confidence;
      if (scoreA !== scoreB)
        return scoreB - scoreA;
      const timeA = new Date(a.lastAccessed).getTime();
      const timeB = new Date(b.lastAccessed).getTime();
      return timeB - timeA;
    });
    return results;
  }
  getMemoriesByType(type) {
    return this.store[type];
  }
  getAllMemories() {
    return [
      ...this.store.declarative,
      ...this.store.procedural,
      ...this.store.episodic
    ];
  }
  getStats() {
    const all = this.getAllMemories();
    const byType = {
      declarative: this.store.declarative.length,
      procedural: this.store.procedural.length,
      episodic: this.store.episodic.length
    };
    const avgConfidence = all.length > 0 ? all.reduce((sum, m) => sum + m.provenance.confidence, 0) / all.length : 0;
    const sorted = [...all].sort((a, b) => new Date(a.provenance.timestamp).getTime() - new Date(b.provenance.timestamp).getTime());
    return {
      total: all.length,
      byType,
      avgConfidence: Math.round(avgConfidence * 100) / 100,
      oldestMemory: sorted[0]?.id || null,
      newestMemory: sorted[sorted.length - 1]?.id || null
    };
  }
  applyConfidenceDecay(entry) {
    const now = new Date;
    const created = new Date(entry.provenance.timestamp);
    const daysSinceCreation = (now.getTime() - created.getTime()) / (1000 * 60 * 60 * 24);
    if (entry.provenance.source === "inferred") {
      const decayFactor = (1 - this.config.confidenceDecayRate) ** daysSinceCreation;
      entry.provenance.confidence *= decayFactor;
    } else if (entry.provenance.source === "agent") {
      const decayFactor = (1 - this.config.confidenceDecayRate * 0.5) ** daysSinceCreation;
      entry.provenance.confidence *= decayFactor;
    }
    return entry;
  }
  async archiveOldMemories(daysThreshold = 30) {
    const now = new Date;
    let archived = 0;
    for (const type of ["declarative", "procedural"]) {
      const toArchive = this.store[type].filter((entry) => {
        const created = new Date(entry.provenance.timestamp);
        const daysSinceCreation = (now.getTime() - created.getTime()) / (1000 * 60 * 60 * 24);
        return daysSinceCreation > daysThreshold && entry.accessCount < 3;
      });
      for (const entry of toArchive) {
        const summary = `[${type}] ${entry.content.substring(0, 100)}... (archived from ${entry.provenance.timestamp})`;
        await this.addMemory("episodic", summary, {
          source: "inferred",
          context: `Archived from ${type}`,
          tags: ["archived", type]
        });
        const index = this.store[type].indexOf(entry);
        if (index > -1) {
          this.store[type].splice(index, 1);
          archived++;
        }
      }
    }
    if (archived > 0) {
      await this.saveMemories();
    }
    return archived;
  }
  getSummary(maxItems = 5) {
    const stats = this.getStats();
    const lines = [
      "## Memory System",
      `Total memories: ${stats.total}`,
      `- Declarative: ${stats.byType.declarative}`,
      `- Procedural: ${stats.byType.procedural}`,
      `- Episodic: ${stats.byType.episodic}`,
      `Average confidence: ${stats.avgConfidence}`,
      ""
    ];
    const recent = this.getAllMemories().sort((a, b) => new Date(b.lastAccessed).getTime() - new Date(a.lastAccessed).getTime()).filter((m) => m.provenance.confidence > 0.7).slice(0, maxItems);
    if (recent.length > 0) {
      lines.push("### Recent High-Confidence Memories");
      for (const mem of recent) {
        lines.push(`- [${mem.type}] ${mem.content.substring(0, 80)}...`);
      }
    }
    return lines.join(`
`);
  }
}
var defaultManager = null;
function getMemoryManager(config) {
  if (!defaultManager) {
    defaultManager = new MemoryManager(config);
  }
  return defaultManager;
}
export {
  getMemoryManager,
  MemoryManager
};

//# debugId=CC47090A7F9B22F464756E2164756E21
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vc3JjL2NvbnRleHQvbWVtb3J5LnRzIiwgIi4uL3NyYy9jb250ZXh0L3R5cGVzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWwogICAgIi8qKlxuICogTWVtb3J5IFN5c3RlbVxuICpcbiAqIEltcGxlbWVudHMgZGVjbGFyYXRpdmUsIHByb2NlZHVyYWwsIGFuZCBlcGlzb2RpYyBtZW1vcnkgd2l0aCBwcm92ZW5hbmNlIHRyYWNraW5nLlxuICogTWVtb3JpZXMgcGVyc2lzdCBhY3Jvc3Mgc2Vzc2lvbnMgYW5kIGluY2x1ZGUgY29uZmlkZW5jZSBzY29yZXMgdGhhdCBkZWNheSBvdmVyIHRpbWUuXG4gKi9cblxuaW1wb3J0IHsgZXhpc3RzU3luYyB9IGZyb20gXCJub2RlOmZzXCI7XG5pbXBvcnQgeyBta2RpciwgcmVhZEZpbGUsIHdyaXRlRmlsZSB9IGZyb20gXCJub2RlOmZzL3Byb21pc2VzXCI7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSBcIm5vZGU6cGF0aFwiO1xuaW1wb3J0IHR5cGUge1xuICAgIENvbW1hbmRDb250ZXh0RW52ZWxvcGUsXG4gICAgQ29udGV4dENvbmZpZyxcbiAgICBNZW1vcnlFbnRyeSxcbiAgICBNZW1vcnlTb3VyY2UsXG4gICAgTWVtb3J5U3RvcmUsXG4gICAgTWVtb3J5VHlwZSxcbn0gZnJvbSBcIi4vdHlwZXNcIjtcbmltcG9ydCB7IERFRkFVTFRfQ09ORklHIH0gZnJvbSBcIi4vdHlwZXNcIjtcblxuZXhwb3J0IGNsYXNzIE1lbW9yeU1hbmFnZXIge1xuICAgIHByaXZhdGUgY29uZmlnOiBDb250ZXh0Q29uZmlnO1xuICAgIHByaXZhdGUgbWVtb3J5RGlyOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBzdG9yZTogTWVtb3J5U3RvcmUgPSB7XG4gICAgICAgIGRlY2xhcmF0aXZlOiBbXSxcbiAgICAgICAgcHJvY2VkdXJhbDogW10sXG4gICAgICAgIGVwaXNvZGljOiBbXSxcbiAgICB9O1xuXG4gICAgY29uc3RydWN0b3IoY29uZmlnOiBQYXJ0aWFsPENvbnRleHRDb25maWc+ID0ge30pIHtcbiAgICAgICAgdGhpcy5jb25maWcgPSB7IC4uLkRFRkFVTFRfQ09ORklHLCAuLi5jb25maWcgfTtcbiAgICAgICAgdGhpcy5tZW1vcnlEaXIgPSBqb2luKHRoaXMuY29uZmlnLnN0b3JhZ2VQYXRoLCBcIm1lbW9yeVwiKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHRoZSBtZW1vcnkgbWFuYWdlciBhbmQgbG9hZCBleGlzdGluZyBtZW1vcmllc1xuICAgICAqL1xuICAgIGFzeW5jIGluaXRpYWxpemUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IG1rZGlyKHRoaXMubWVtb3J5RGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkTWVtb3JpZXMoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMb2FkIGFsbCBtZW1vcmllcyBmcm9tIGRpc2tcbiAgICAgKi9cbiAgICBwcml2YXRlIGFzeW5jIGxvYWRNZW1vcmllcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgdHlwZXM6IE1lbW9yeVR5cGVbXSA9IFtcImRlY2xhcmF0aXZlXCIsIFwicHJvY2VkdXJhbFwiLCBcImVwaXNvZGljXCJdO1xuXG4gICAgICAgIGZvciAoY29uc3QgdHlwZSBvZiB0eXBlcykge1xuICAgICAgICAgICAgY29uc3QgcGF0aCA9IGpvaW4odGhpcy5tZW1vcnlEaXIsIGAke3R5cGV9Lmpzb25gKTtcbiAgICAgICAgICAgIGlmIChleGlzdHNTeW5jKHBhdGgpKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHJlYWRGaWxlKHBhdGgsIFwidXRmLThcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcmVbdHlwZV0gPSBKU09OLnBhcnNlKGNvbnRlbnQpIGFzIE1lbW9yeUVudHJ5W107XG4gICAgICAgICAgICAgICAgICAgIC8vIEFwcGx5IGNvbmZpZGVuY2UgZGVjYXlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9yZVt0eXBlXSA9IHRoaXMuc3RvcmVbdHlwZV0ubWFwKChlbnRyeSkgPT5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlDb25maWRlbmNlRGVjYXkoZW50cnkpLFxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBsb2FkICR7dHlwZX0gbWVtb3JpZXM6YCwgZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNhdmUgYWxsIG1lbW9yaWVzIHRvIGRpc2tcbiAgICAgKi9cbiAgICBwcml2YXRlIGFzeW5jIHNhdmVNZW1vcmllcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgdHlwZXM6IE1lbW9yeVR5cGVbXSA9IFtcImRlY2xhcmF0aXZlXCIsIFwicHJvY2VkdXJhbFwiLCBcImVwaXNvZGljXCJdO1xuXG4gICAgICAgIGZvciAoY29uc3QgdHlwZSBvZiB0eXBlcykge1xuICAgICAgICAgICAgY29uc3QgcGF0aCA9IGpvaW4odGhpcy5tZW1vcnlEaXIsIGAke3R5cGV9Lmpzb25gKTtcbiAgICAgICAgICAgIGF3YWl0IHdyaXRlRmlsZShwYXRoLCBKU09OLnN0cmluZ2lmeSh0aGlzLnN0b3JlW3R5cGVdLCBudWxsLCAyKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGQgYSBtZW1vcnkgZW50cnlcbiAgICAgKi9cbiAgICBhc3luYyBhZGRNZW1vcnkoXG4gICAgICAgIHR5cGU6IE1lbW9yeVR5cGUsXG4gICAgICAgIGNvbnRlbnQ6IHN0cmluZyxcbiAgICAgICAgb3B0aW9ucz86IHtcbiAgICAgICAgICAgIHNvdXJjZT86IE1lbW9yeVNvdXJjZTtcbiAgICAgICAgICAgIGNvbnRleHQ/OiBzdHJpbmc7XG4gICAgICAgICAgICBzZXNzaW9uSWQ/OiBzdHJpbmc7XG4gICAgICAgICAgICB0YWdzPzogc3RyaW5nW107XG4gICAgICAgICAgICBjb25maWRlbmNlPzogbnVtYmVyO1xuICAgICAgICB9LFxuICAgICk6IFByb21pc2U8TWVtb3J5RW50cnk+IHtcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgICBjb25zdCBlbnRyeTogTWVtb3J5RW50cnkgPSB7XG4gICAgICAgICAgICBpZDogYG1lbV8ke0RhdGUubm93KCkudG9TdHJpbmcoMzYpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCA4KX1gLFxuICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgIGNvbnRlbnQsXG4gICAgICAgICAgICBwcm92ZW5hbmNlOiB7XG4gICAgICAgICAgICAgICAgc291cmNlOiBvcHRpb25zPy5zb3VyY2UgfHwgXCJ1c2VyXCIsXG4gICAgICAgICAgICAgICAgdGltZXN0YW1wOiBub3csXG4gICAgICAgICAgICAgICAgY29uZmlkZW5jZTpcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucz8uY29uZmlkZW5jZSA/P1xuICAgICAgICAgICAgICAgICAgICAob3B0aW9ucz8uc291cmNlID09PSBcImluZmVycmVkXCIgPyAwLjcgOiAxLjApLFxuICAgICAgICAgICAgICAgIGNvbnRleHQ6IG9wdGlvbnM/LmNvbnRleHQgfHwgXCJcIixcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQ6IG9wdGlvbnM/LnNlc3Npb25JZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0YWdzOiBvcHRpb25zPy50YWdzIHx8IFtdLFxuICAgICAgICAgICAgbGFzdEFjY2Vzc2VkOiBub3csXG4gICAgICAgICAgICBhY2Nlc3NDb3VudDogMCxcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnN0b3JlW3R5cGVdLnB1c2goZW50cnkpO1xuXG4gICAgICAgIC8vIEVuZm9yY2UgbWF4IG1lbW9yaWVzIHBlciB0eXBlXG4gICAgICAgIGlmICh0aGlzLnN0b3JlW3R5cGVdLmxlbmd0aCA+IHRoaXMuY29uZmlnLm1heE1lbW9yaWVzUGVyVHlwZSkge1xuICAgICAgICAgICAgLy8gUmVtb3ZlIG9sZGVzdCwgbGVhc3QgYWNjZXNzZWQgZW50cmllc1xuICAgICAgICAgICAgdGhpcy5zdG9yZVt0eXBlXS5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2NvcmVBID1cbiAgICAgICAgICAgICAgICAgICAgYS5hY2Nlc3NDb3VudCAvXG4gICAgICAgICAgICAgICAgICAgIChEYXRlLm5vdygpIC0gbmV3IERhdGUoYS5sYXN0QWNjZXNzZWQpLmdldFRpbWUoKSk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2NvcmVCID1cbiAgICAgICAgICAgICAgICAgICAgYi5hY2Nlc3NDb3VudCAvXG4gICAgICAgICAgICAgICAgICAgIChEYXRlLm5vdygpIC0gbmV3IERhdGUoYi5sYXN0QWNjZXNzZWQpLmdldFRpbWUoKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjb3JlQSAtIHNjb3JlQjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5zdG9yZVt0eXBlXSA9IHRoaXMuc3RvcmVbdHlwZV0uc2xpY2UoXG4gICAgICAgICAgICAgICAgLXRoaXMuY29uZmlnLm1heE1lbW9yaWVzUGVyVHlwZSxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBhd2FpdCB0aGlzLnNhdmVNZW1vcmllcygpO1xuICAgICAgICByZXR1cm4gZW50cnk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIGEgbWVtb3J5IGVudHJ5XG4gICAgICovXG4gICAgYXN5bmMgdXBkYXRlTWVtb3J5KFxuICAgICAgICBpZDogc3RyaW5nLFxuICAgICAgICB1cGRhdGVzOiBQYXJ0aWFsPE9taXQ8TWVtb3J5RW50cnksIFwiaWRcIiB8IFwicHJvdmVuYW5jZVwiPj4sXG4gICAgKTogUHJvbWlzZTxNZW1vcnlFbnRyeSB8IG51bGw+IHtcbiAgICAgICAgZm9yIChjb25zdCB0eXBlIG9mIE9iamVjdC5rZXlzKHRoaXMuc3RvcmUpIGFzIE1lbW9yeVR5cGVbXSkge1xuICAgICAgICAgICAgY29uc3QgZW50cnkgPSB0aGlzLnN0b3JlW3R5cGVdLmZpbmQoKGUpID0+IGUuaWQgPT09IGlkKTtcbiAgICAgICAgICAgIGlmIChlbnRyeSkge1xuICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZW50cnksIHVwZGF0ZXMpO1xuICAgICAgICAgICAgICAgIGVudHJ5Lmxhc3RBY2Nlc3NlZCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnNhdmVNZW1vcmllcygpO1xuICAgICAgICAgICAgICAgIHJldHVybiBlbnRyeTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBY2Nlc3MgYSBtZW1vcnkgKHVwZGF0ZXMgYWNjZXNzIGNvdW50IGFuZCB0aW1lc3RhbXApXG4gICAgICovXG4gICAgYXN5bmMgYWNjZXNzTWVtb3J5KGlkOiBzdHJpbmcpOiBQcm9taXNlPE1lbW9yeUVudHJ5IHwgbnVsbD4ge1xuICAgICAgICBmb3IgKGNvbnN0IHR5cGUgb2YgT2JqZWN0LmtleXModGhpcy5zdG9yZSkgYXMgTWVtb3J5VHlwZVtdKSB7XG4gICAgICAgICAgICBjb25zdCBlbnRyeSA9IHRoaXMuc3RvcmVbdHlwZV0uZmluZCgoZSkgPT4gZS5pZCA9PT0gaWQpO1xuICAgICAgICAgICAgaWYgKGVudHJ5KSB7XG4gICAgICAgICAgICAgICAgZW50cnkubGFzdEFjY2Vzc2VkID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgIGVudHJ5LmFjY2Vzc0NvdW50Kys7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zYXZlTWVtb3JpZXMoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZW50cnk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVsZXRlIGEgbWVtb3J5IGVudHJ5XG4gICAgICovXG4gICAgYXN5bmMgZGVsZXRlTWVtb3J5KGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgICAgZm9yIChjb25zdCB0eXBlIG9mIE9iamVjdC5rZXlzKHRoaXMuc3RvcmUpIGFzIE1lbW9yeVR5cGVbXSkge1xuICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnN0b3JlW3R5cGVdLmZpbmRJbmRleCgoZSkgPT4gZS5pZCA9PT0gaWQpO1xuICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3JlW3R5cGVdLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zYXZlTWVtb3JpZXMoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU3RvcmUgYSBjb21tYW5kIGV4ZWN1dGlvbiBlbnZlbG9wZSBhcyBlcGlzb2RpYyBtZW1vcnkuXG4gICAgICovXG4gICAgYXN5bmMgc3RvcmVDb21tYW5kRW52ZWxvcGUoXG4gICAgICAgIGVudmVsb3BlOiBDb21tYW5kQ29udGV4dEVudmVsb3BlLFxuICAgICAgICBvcHRpb25zPzoge1xuICAgICAgICAgICAgc291cmNlPzogTWVtb3J5U291cmNlO1xuICAgICAgICAgICAgY29uZmlkZW5jZT86IG51bWJlcjtcbiAgICAgICAgICAgIGNvbnRleHQ/OiBzdHJpbmc7XG4gICAgICAgIH0sXG4gICAgKTogUHJvbWlzZTxNZW1vcnlFbnRyeT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5hZGRNZW1vcnkoXCJlcGlzb2RpY1wiLCBKU09OLnN0cmluZ2lmeShlbnZlbG9wZSwgbnVsbCwgMiksIHtcbiAgICAgICAgICAgIHNvdXJjZTogb3B0aW9ucz8uc291cmNlID8/IFwiYWdlbnRcIixcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IG9wdGlvbnM/LmNvbmZpZGVuY2UgPz8gMS4wLFxuICAgICAgICAgICAgY29udGV4dDpcbiAgICAgICAgICAgICAgICBvcHRpb25zPy5jb250ZXh0ID8/IGBDb21tYW5kIGVudmVsb3BlOiAke2VudmVsb3BlLmNvbW1hbmROYW1lfWAsXG4gICAgICAgICAgICBzZXNzaW9uSWQ6IGVudmVsb3BlLnNlc3Npb25JZCxcbiAgICAgICAgICAgIHRhZ3M6IGVudmVsb3BlLnRhZ3MsXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgbW9zdCByZWNlbnRseSBhZGRlZCBjb21tYW5kIGVudmVsb3BlLlxuICAgICAqL1xuICAgIGdldExhdGVzdENvbW1hbmRFbnZlbG9wZShmaWx0ZXI/OiB7XG4gICAgICAgIGNvbW1hbmROYW1lPzogc3RyaW5nO1xuICAgICAgICBzZXNzaW9uSWQ/OiBzdHJpbmc7XG4gICAgfSk6IENvbW1hbmRDb250ZXh0RW52ZWxvcGUgfCBudWxsIHtcbiAgICAgICAgY29uc3QgZXBpc29kaWMgPSB0aGlzLmdldE1lbW9yaWVzQnlUeXBlKFwiZXBpc29kaWNcIik7XG5cbiAgICAgICAgY29uc3QgY2FuZGlkYXRlcyA9IGVwaXNvZGljXG4gICAgICAgICAgICAuZmlsdGVyKChlbnRyeSkgPT4gZW50cnkudGFncy5pbmNsdWRlcyhcImNvbW1hbmQtZW52ZWxvcGVcIikpXG4gICAgICAgICAgICAuZmlsdGVyKChlbnRyeSkgPT5cbiAgICAgICAgICAgICAgICBmaWx0ZXI/LmNvbW1hbmROYW1lXG4gICAgICAgICAgICAgICAgICAgID8gZW50cnkudGFncy5pbmNsdWRlcyhgY29tbWFuZDoke2ZpbHRlci5jb21tYW5kTmFtZX1gKVxuICAgICAgICAgICAgICAgICAgICA6IHRydWUsXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAuZmlsdGVyKChlbnRyeSkgPT5cbiAgICAgICAgICAgICAgICBmaWx0ZXI/LnNlc3Npb25JZFxuICAgICAgICAgICAgICAgICAgICA/IGVudHJ5LnByb3ZlbmFuY2Uuc2Vzc2lvbklkID09PSBmaWx0ZXIuc2Vzc2lvbklkXG4gICAgICAgICAgICAgICAgICAgIDogdHJ1ZSxcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5zb3J0KFxuICAgICAgICAgICAgICAgIChhLCBiKSA9PlxuICAgICAgICAgICAgICAgICAgICBuZXcgRGF0ZShiLnByb3ZlbmFuY2UudGltZXN0YW1wKS5nZXRUaW1lKCkgLVxuICAgICAgICAgICAgICAgICAgICBuZXcgRGF0ZShhLnByb3ZlbmFuY2UudGltZXN0YW1wKS5nZXRUaW1lKCksXG4gICAgICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IGxhdGVzdCA9IGNhbmRpZGF0ZXNbMF07XG4gICAgICAgIGlmICghbGF0ZXN0KSByZXR1cm4gbnVsbDtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UobGF0ZXN0LmNvbnRlbnQpIGFzIENvbW1hbmRDb250ZXh0RW52ZWxvcGU7XG4gICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZWFyY2ggbWVtb3JpZXMgYnkgY29udGVudCBvciB0YWdzXG4gICAgICovXG4gICAgc2VhcmNoTWVtb3JpZXMoXG4gICAgICAgIHF1ZXJ5OiBzdHJpbmcsXG4gICAgICAgIG9wdGlvbnM/OiB7XG4gICAgICAgICAgICB0eXBlPzogTWVtb3J5VHlwZTtcbiAgICAgICAgICAgIHRhZ3M/OiBzdHJpbmdbXTtcbiAgICAgICAgICAgIG1pbkNvbmZpZGVuY2U/OiBudW1iZXI7XG4gICAgICAgIH0sXG4gICAgKTogTWVtb3J5RW50cnlbXSB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5TG93ZXIgPSBxdWVyeS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBjb25zdCByZXN1bHRzOiBNZW1vcnlFbnRyeVtdID0gW107XG5cbiAgICAgICAgY29uc3QgdHlwZXMgPSBvcHRpb25zPy50eXBlXG4gICAgICAgICAgICA/IFtvcHRpb25zLnR5cGVdXG4gICAgICAgICAgICA6IChPYmplY3Qua2V5cyh0aGlzLnN0b3JlKSBhcyBNZW1vcnlUeXBlW10pO1xuXG4gICAgICAgIGZvciAoY29uc3QgdHlwZSBvZiB0eXBlcykge1xuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKFxuICAgICAgICAgICAgICAgIC4uLnRoaXMuc3RvcmVbdHlwZV0uZmlsdGVyKChlbnRyeSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBDb250ZW50IG1hdGNoXG4gICAgICAgICAgICAgICAgICAgIGlmICghZW50cnkuY29udGVudC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHF1ZXJ5TG93ZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBUYWcgbWF0Y2hcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnM/LnRhZ3MgJiYgb3B0aW9ucy50YWdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhb3B0aW9ucy50YWdzLnNvbWUoKHRhZykgPT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkudGFncy5pbmNsdWRlcyh0YWcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIENvbmZpZGVuY2UgdGhyZXNob2xkXG4gICAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM/Lm1pbkNvbmZpZGVuY2UgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LnByb3ZlbmFuY2UuY29uZmlkZW5jZSA8IG9wdGlvbnMubWluQ29uZmlkZW5jZVxuICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNvcnQgYnkgcmVsZXZhbmNlIChhY2Nlc3MgY291bnQsIGNvbmZpZGVuY2UsIHJlY2VuY3kpXG4gICAgICAgIHJlc3VsdHMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc2NvcmVBID0gYS5hY2Nlc3NDb3VudCAqIGEucHJvdmVuYW5jZS5jb25maWRlbmNlO1xuICAgICAgICAgICAgY29uc3Qgc2NvcmVCID0gYi5hY2Nlc3NDb3VudCAqIGIucHJvdmVuYW5jZS5jb25maWRlbmNlO1xuICAgICAgICAgICAgaWYgKHNjb3JlQSAhPT0gc2NvcmVCKSByZXR1cm4gc2NvcmVCIC0gc2NvcmVBO1xuXG4gICAgICAgICAgICBjb25zdCB0aW1lQSA9IG5ldyBEYXRlKGEubGFzdEFjY2Vzc2VkKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICBjb25zdCB0aW1lQiA9IG5ldyBEYXRlKGIubGFzdEFjY2Vzc2VkKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICByZXR1cm4gdGltZUIgLSB0aW1lQTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IG1lbW9yaWVzIGJ5IHR5cGVcbiAgICAgKi9cbiAgICBnZXRNZW1vcmllc0J5VHlwZSh0eXBlOiBNZW1vcnlUeXBlKTogTWVtb3J5RW50cnlbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0b3JlW3R5cGVdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhbGwgbWVtb3JpZXNcbiAgICAgKi9cbiAgICBnZXRBbGxNZW1vcmllcygpOiBNZW1vcnlFbnRyeVtdIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIC4uLnRoaXMuc3RvcmUuZGVjbGFyYXRpdmUsXG4gICAgICAgICAgICAuLi50aGlzLnN0b3JlLnByb2NlZHVyYWwsXG4gICAgICAgICAgICAuLi50aGlzLnN0b3JlLmVwaXNvZGljLFxuICAgICAgICBdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBtZW1vcnkgc3RhdGlzdGljc1xuICAgICAqL1xuICAgIGdldFN0YXRzKCk6IHtcbiAgICAgICAgdG90YWw6IG51bWJlcjtcbiAgICAgICAgYnlUeXBlOiBSZWNvcmQ8TWVtb3J5VHlwZSwgbnVtYmVyPjtcbiAgICAgICAgYXZnQ29uZmlkZW5jZTogbnVtYmVyO1xuICAgICAgICBvbGRlc3RNZW1vcnk6IHN0cmluZyB8IG51bGw7XG4gICAgICAgIG5ld2VzdE1lbW9yeTogc3RyaW5nIHwgbnVsbDtcbiAgICB9IHtcbiAgICAgICAgY29uc3QgYWxsID0gdGhpcy5nZXRBbGxNZW1vcmllcygpO1xuICAgICAgICBjb25zdCBieVR5cGU6IFJlY29yZDxNZW1vcnlUeXBlLCBudW1iZXI+ID0ge1xuICAgICAgICAgICAgZGVjbGFyYXRpdmU6IHRoaXMuc3RvcmUuZGVjbGFyYXRpdmUubGVuZ3RoLFxuICAgICAgICAgICAgcHJvY2VkdXJhbDogdGhpcy5zdG9yZS5wcm9jZWR1cmFsLmxlbmd0aCxcbiAgICAgICAgICAgIGVwaXNvZGljOiB0aGlzLnN0b3JlLmVwaXNvZGljLmxlbmd0aCxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBhdmdDb25maWRlbmNlID1cbiAgICAgICAgICAgIGFsbC5sZW5ndGggPiAwXG4gICAgICAgICAgICAgICAgPyBhbGwucmVkdWNlKChzdW0sIG0pID0+IHN1bSArIG0ucHJvdmVuYW5jZS5jb25maWRlbmNlLCAwKSAvXG4gICAgICAgICAgICAgICAgICBhbGwubGVuZ3RoXG4gICAgICAgICAgICAgICAgOiAwO1xuXG4gICAgICAgIGNvbnN0IHNvcnRlZCA9IFsuLi5hbGxdLnNvcnQoXG4gICAgICAgICAgICAoYSwgYikgPT5cbiAgICAgICAgICAgICAgICBuZXcgRGF0ZShhLnByb3ZlbmFuY2UudGltZXN0YW1wKS5nZXRUaW1lKCkgLVxuICAgICAgICAgICAgICAgIG5ldyBEYXRlKGIucHJvdmVuYW5jZS50aW1lc3RhbXApLmdldFRpbWUoKSxcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdG90YWw6IGFsbC5sZW5ndGgsXG4gICAgICAgICAgICBieVR5cGUsXG4gICAgICAgICAgICBhdmdDb25maWRlbmNlOiBNYXRoLnJvdW5kKGF2Z0NvbmZpZGVuY2UgKiAxMDApIC8gMTAwLFxuICAgICAgICAgICAgb2xkZXN0TWVtb3J5OiBzb3J0ZWRbMF0/LmlkIHx8IG51bGwsXG4gICAgICAgICAgICBuZXdlc3RNZW1vcnk6IHNvcnRlZFtzb3J0ZWQubGVuZ3RoIC0gMV0/LmlkIHx8IG51bGwsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXBwbHkgY29uZmlkZW5jZSBkZWNheSB0byBhIG1lbW9yeSBiYXNlZCBvbiBhZ2VcbiAgICAgKiBJbmZlcnJlZCBtZW1vcmllcyBkZWNheSBmYXN0ZXIgdGhhbiB1c2VyLXByb3ZpZGVkIG9uZXNcbiAgICAgKi9cbiAgICBwcml2YXRlIGFwcGx5Q29uZmlkZW5jZURlY2F5KGVudHJ5OiBNZW1vcnlFbnRyeSk6IE1lbW9yeUVudHJ5IHtcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgY3JlYXRlZCA9IG5ldyBEYXRlKGVudHJ5LnByb3ZlbmFuY2UudGltZXN0YW1wKTtcbiAgICAgICAgY29uc3QgZGF5c1NpbmNlQ3JlYXRpb24gPVxuICAgICAgICAgICAgKG5vdy5nZXRUaW1lKCkgLSBjcmVhdGVkLmdldFRpbWUoKSkgLyAoMTAwMCAqIDYwICogNjAgKiAyNCk7XG5cbiAgICAgICAgaWYgKGVudHJ5LnByb3ZlbmFuY2Uuc291cmNlID09PSBcImluZmVycmVkXCIpIHtcbiAgICAgICAgICAgIC8vIEluZmVycmVkIG1lbW9yaWVzIGRlY2F5IGZhc3RlclxuICAgICAgICAgICAgY29uc3QgZGVjYXlGYWN0b3IgPVxuICAgICAgICAgICAgICAgICgxIC0gdGhpcy5jb25maWcuY29uZmlkZW5jZURlY2F5UmF0ZSkgKiogZGF5c1NpbmNlQ3JlYXRpb247XG4gICAgICAgICAgICBlbnRyeS5wcm92ZW5hbmNlLmNvbmZpZGVuY2UgKj0gZGVjYXlGYWN0b3I7XG4gICAgICAgIH0gZWxzZSBpZiAoZW50cnkucHJvdmVuYW5jZS5zb3VyY2UgPT09IFwiYWdlbnRcIikge1xuICAgICAgICAgICAgLy8gQWdlbnQgbWVtb3JpZXMgZGVjYXkgc2xvd2VyXG4gICAgICAgICAgICBjb25zdCBkZWNheUZhY3RvciA9XG4gICAgICAgICAgICAgICAgKDEgLSB0aGlzLmNvbmZpZy5jb25maWRlbmNlRGVjYXlSYXRlICogMC41KSAqKlxuICAgICAgICAgICAgICAgIGRheXNTaW5jZUNyZWF0aW9uO1xuICAgICAgICAgICAgZW50cnkucHJvdmVuYW5jZS5jb25maWRlbmNlICo9IGRlY2F5RmFjdG9yO1xuICAgICAgICB9XG4gICAgICAgIC8vIFVzZXIgbWVtb3JpZXMgZG9uJ3QgZGVjYXlcblxuICAgICAgICByZXR1cm4gZW50cnk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXJjaGl2ZSBvbGQgbWVtb3JpZXMgKG1vdmUgdG8gZXBpc29kaWMgc3VtbWFyeSlcbiAgICAgKi9cbiAgICBhc3luYyBhcmNoaXZlT2xkTWVtb3JpZXMoZGF5c1RocmVzaG9sZCA9IDMwKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgbGV0IGFyY2hpdmVkID0gMDtcblxuICAgICAgICBmb3IgKGNvbnN0IHR5cGUgb2YgW1wiZGVjbGFyYXRpdmVcIiwgXCJwcm9jZWR1cmFsXCJdIGFzIE1lbW9yeVR5cGVbXSkge1xuICAgICAgICAgICAgY29uc3QgdG9BcmNoaXZlID0gdGhpcy5zdG9yZVt0eXBlXS5maWx0ZXIoKGVudHJ5KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3JlYXRlZCA9IG5ldyBEYXRlKGVudHJ5LnByb3ZlbmFuY2UudGltZXN0YW1wKTtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXlzU2luY2VDcmVhdGlvbiA9XG4gICAgICAgICAgICAgICAgICAgIChub3cuZ2V0VGltZSgpIC0gY3JlYXRlZC5nZXRUaW1lKCkpIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpO1xuICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgIGRheXNTaW5jZUNyZWF0aW9uID4gZGF5c1RocmVzaG9sZCAmJiBlbnRyeS5hY2Nlc3NDb3VudCA8IDNcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgdG9BcmNoaXZlKSB7XG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGVwaXNvZGljIHN1bW1hcnlcbiAgICAgICAgICAgICAgICBjb25zdCBzdW1tYXJ5ID0gYFske3R5cGV9XSAke2VudHJ5LmNvbnRlbnQuc3Vic3RyaW5nKDAsIDEwMCl9Li4uIChhcmNoaXZlZCBmcm9tICR7ZW50cnkucHJvdmVuYW5jZS50aW1lc3RhbXB9KWA7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hZGRNZW1vcnkoXCJlcGlzb2RpY1wiLCBzdW1tYXJ5LCB7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZTogXCJpbmZlcnJlZFwiLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiBgQXJjaGl2ZWQgZnJvbSAke3R5cGV9YCxcbiAgICAgICAgICAgICAgICAgICAgdGFnczogW1wiYXJjaGl2ZWRcIiwgdHlwZV0sXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgZnJvbSBvcmlnaW5hbCB0eXBlXG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnN0b3JlW3R5cGVdLmluZGV4T2YoZW50cnkpO1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcmVbdHlwZV0uc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgYXJjaGl2ZWQrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYXJjaGl2ZWQgPiAwKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNhdmVNZW1vcmllcygpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFyY2hpdmVkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhIHN1bW1hcnkgb2YgbWVtb3JpZXMgZm9yIGNvbnRleHQgYXNzZW1ibHlcbiAgICAgKi9cbiAgICBnZXRTdW1tYXJ5KG1heEl0ZW1zID0gNSk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IHN0YXRzID0gdGhpcy5nZXRTdGF0cygpO1xuICAgICAgICBjb25zdCBsaW5lcyA9IFtcbiAgICAgICAgICAgIFwiIyMgTWVtb3J5IFN5c3RlbVwiLFxuICAgICAgICAgICAgYFRvdGFsIG1lbW9yaWVzOiAke3N0YXRzLnRvdGFsfWAsXG4gICAgICAgICAgICBgLSBEZWNsYXJhdGl2ZTogJHtzdGF0cy5ieVR5cGUuZGVjbGFyYXRpdmV9YCxcbiAgICAgICAgICAgIGAtIFByb2NlZHVyYWw6ICR7c3RhdHMuYnlUeXBlLnByb2NlZHVyYWx9YCxcbiAgICAgICAgICAgIGAtIEVwaXNvZGljOiAke3N0YXRzLmJ5VHlwZS5lcGlzb2RpY31gLFxuICAgICAgICAgICAgYEF2ZXJhZ2UgY29uZmlkZW5jZTogJHtzdGF0cy5hdmdDb25maWRlbmNlfWAsXG4gICAgICAgICAgICBcIlwiLFxuICAgICAgICBdO1xuXG4gICAgICAgIC8vIEFkZCByZWNlbnQgaGlnaC1jb25maWRlbmNlIG1lbW9yaWVzXG4gICAgICAgIGNvbnN0IHJlY2VudCA9IHRoaXMuZ2V0QWxsTWVtb3JpZXMoKVxuICAgICAgICAgICAgLnNvcnQoXG4gICAgICAgICAgICAgICAgKGEsIGIpID0+XG4gICAgICAgICAgICAgICAgICAgIG5ldyBEYXRlKGIubGFzdEFjY2Vzc2VkKS5nZXRUaW1lKCkgLVxuICAgICAgICAgICAgICAgICAgICBuZXcgRGF0ZShhLmxhc3RBY2Nlc3NlZCkuZ2V0VGltZSgpLFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLmZpbHRlcigobSkgPT4gbS5wcm92ZW5hbmNlLmNvbmZpZGVuY2UgPiAwLjcpXG4gICAgICAgICAgICAuc2xpY2UoMCwgbWF4SXRlbXMpO1xuXG4gICAgICAgIGlmIChyZWNlbnQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgbGluZXMucHVzaChcIiMjIyBSZWNlbnQgSGlnaC1Db25maWRlbmNlIE1lbW9yaWVzXCIpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBtZW0gb2YgcmVjZW50KSB7XG4gICAgICAgICAgICAgICAgbGluZXMucHVzaChcbiAgICAgICAgICAgICAgICAgICAgYC0gWyR7bWVtLnR5cGV9XSAke21lbS5jb250ZW50LnN1YnN0cmluZygwLCA4MCl9Li4uYCxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGxpbmVzLmpvaW4oXCJcXG5cIik7XG4gICAgfVxufVxuXG4vLyBTaW5nbGV0b24gaW5zdGFuY2UgZm9yIGNvbnZlbmllbmNlXG5sZXQgZGVmYXVsdE1hbmFnZXI6IE1lbW9yeU1hbmFnZXIgfCBudWxsID0gbnVsbDtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldE1lbW9yeU1hbmFnZXIoXG4gICAgY29uZmlnPzogUGFydGlhbDxDb250ZXh0Q29uZmlnPixcbik6IE1lbW9yeU1hbmFnZXIge1xuICAgIGlmICghZGVmYXVsdE1hbmFnZXIpIHtcbiAgICAgICAgZGVmYXVsdE1hbmFnZXIgPSBuZXcgTWVtb3J5TWFuYWdlcihjb25maWcpO1xuICAgIH1cbiAgICByZXR1cm4gZGVmYXVsdE1hbmFnZXI7XG59XG4iLAogICAgIi8qKlxuICogQ29udGV4dCBFbmdpbmVlcmluZyBUeXBlIERlZmluaXRpb25zXG4gKlxuICogQ29yZSB0eXBlcyBmb3Igc2Vzc2lvbiBtYW5hZ2VtZW50LCBtZW1vcnkgc3lzdGVtLCBhbmQgcHJvZ3Jlc3NpdmUgZGlzY2xvc3VyZS5cbiAqIEJhc2VkIG9uIHJlc2VhcmNoIGZyb20gR29vZ2xlJ3MgQ29udGV4dCBFbmdpbmVlcmluZyBhbmQgQ2xhdWRlIFNraWxscyBwYXR0ZXJucy5cbiAqL1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBTZXNzaW9uIFR5cGVzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2Vzc2lvbiB7XG4gICAgaWQ6IHN0cmluZztcbiAgICBwYXJlbnRJRD86IHN0cmluZzsgLy8gUGFyZW50IHNlc3Npb24gSUQgZm9yIG5lc3RlZCBzdWJhZ2VudCBjYWxsc1xuICAgIGNyZWF0ZWRBdDogc3RyaW5nOyAvLyBJU08gZGF0ZSBzdHJpbmdcbiAgICBsYXN0QWN0aXZlOiBzdHJpbmc7IC8vIElTTyBkYXRlIHN0cmluZ1xuICAgIHdvcmtiZW5jaDogU2Vzc2lvbldvcmtiZW5jaDtcbiAgICBtZXRhZGF0YTogU2Vzc2lvbk1ldGFkYXRhO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlc3Npb25Xb3JrYmVuY2gge1xuICAgIC8qKiBDdXJyZW50bHkgYWN0aXZlL29wZW4gZmlsZXMgaW4gdGhlIHNlc3Npb24gKi9cbiAgICBhY3RpdmVGaWxlczogc3RyaW5nW107XG4gICAgLyoqIFBlbmRpbmcgdGFza3MgdHJhY2tlZCBpbiB0aGlzIHNlc3Npb24gKi9cbiAgICBwZW5kaW5nVGFza3M6IFRhc2tbXTtcbiAgICAvKiogQXJjaGl0ZWN0dXJhbC9kZXNpZ24gZGVjaXNpb25zIG1hZGUgKi9cbiAgICBkZWNpc2lvbnM6IERlY2lzaW9uW107XG4gICAgLyoqIEFyYml0cmFyeSBjb250ZXh0IGRhdGEgKi9cbiAgICBjb250ZXh0OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZXNzaW9uTWV0YWRhdGEge1xuICAgIC8qKiBQcm9qZWN0IG5hbWUgb3IgcGF0aCAqL1xuICAgIHByb2plY3Q6IHN0cmluZztcbiAgICAvKiogR2l0IGJyYW5jaCBpZiBhcHBsaWNhYmxlICovXG4gICAgYnJhbmNoPzogc3RyaW5nO1xuICAgIC8qKiBDdXJyZW50IHdvcmtpbmcgbW9kZSAqL1xuICAgIG1vZGU/OiBcInBsYW5cIiB8IFwiYnVpbGRcIiB8IFwicmV2aWV3XCI7XG4gICAgLyoqIFBsYXRmb3JtIGJlaW5nIHVzZWQgKi9cbiAgICBwbGF0Zm9ybT86IFwiY2xhdWRlLWNvZGVcIiB8IFwib3BlbmNvZGVcIjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUYXNrIHtcbiAgICBpZDogc3RyaW5nO1xuICAgIGNvbnRlbnQ6IHN0cmluZztcbiAgICBzdGF0dXM6IFwicGVuZGluZ1wiIHwgXCJpbl9wcm9ncmVzc1wiIHwgXCJjb21wbGV0ZWRcIiB8IFwiY2FuY2VsbGVkXCI7XG4gICAgcHJpb3JpdHk6IFwibG93XCIgfCBcIm1lZGl1bVwiIHwgXCJoaWdoXCI7XG4gICAgY3JlYXRlZEF0OiBzdHJpbmc7XG4gICAgY29tcGxldGVkQXQ/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGVjaXNpb24ge1xuICAgIGlkOiBzdHJpbmc7XG4gICAgdGl0bGU6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgIHJhdGlvbmFsZTogc3RyaW5nO1xuICAgIGFsdGVybmF0aXZlcz86IHN0cmluZ1tdO1xuICAgIGNyZWF0ZWRBdDogc3RyaW5nO1xuICAgIHRhZ3M6IHN0cmluZ1tdO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNZW1vcnkgVHlwZXNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IHR5cGUgTWVtb3J5VHlwZSA9IFwiZGVjbGFyYXRpdmVcIiB8IFwicHJvY2VkdXJhbFwiIHwgXCJlcGlzb2RpY1wiO1xuZXhwb3J0IHR5cGUgTWVtb3J5U291cmNlID0gXCJ1c2VyXCIgfCBcImFnZW50XCIgfCBcImluZmVycmVkXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWVtb3J5RW50cnkge1xuICAgIGlkOiBzdHJpbmc7XG4gICAgdHlwZTogTWVtb3J5VHlwZTtcbiAgICBjb250ZW50OiBzdHJpbmc7XG4gICAgcHJvdmVuYW5jZTogTWVtb3J5UHJvdmVuYW5jZTtcbiAgICB0YWdzOiBzdHJpbmdbXTtcbiAgICBsYXN0QWNjZXNzZWQ6IHN0cmluZztcbiAgICBhY2Nlc3NDb3VudDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1lbW9yeVByb3ZlbmFuY2Uge1xuICAgIC8qKiBXaGVyZSB0aGlzIG1lbW9yeSBjYW1lIGZyb20gKi9cbiAgICBzb3VyY2U6IE1lbW9yeVNvdXJjZTtcbiAgICAvKiogV2hlbiB0aGlzIHdhcyByZWNvcmRlZCAqL1xuICAgIHRpbWVzdGFtcDogc3RyaW5nO1xuICAgIC8qKiBDb25maWRlbmNlIGxldmVsIDAtMSAoZGVjYXlzIG92ZXIgdGltZSBmb3IgaW5mZXJyZWQpICovXG4gICAgY29uZmlkZW5jZTogbnVtYmVyO1xuICAgIC8qKiBDb250ZXh0IGluIHdoaWNoIHRoaXMgd2FzIGxlYXJuZWQgKi9cbiAgICBjb250ZXh0OiBzdHJpbmc7XG4gICAgLyoqIFJlbGF0ZWQgc2Vzc2lvbiBJRCBpZiBhcHBsaWNhYmxlICovXG4gICAgc2Vzc2lvbklkPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1lbW9yeVN0b3JlIHtcbiAgICAvKiogRmFjdHMsIHBhdHRlcm5zLCBwcmVmZXJlbmNlcyAqL1xuICAgIGRlY2xhcmF0aXZlOiBNZW1vcnlFbnRyeVtdO1xuICAgIC8qKiBXb3JrZmxvd3MsIHByb2NlZHVyZXMsIGhhYml0cyAqL1xuICAgIHByb2NlZHVyYWw6IE1lbW9yeUVudHJ5W107XG4gICAgLyoqIENvbnZlcnNhdGlvbiBzdW1tYXJpZXMsIHBhc3QgZXZlbnRzICovXG4gICAgZXBpc29kaWM6IE1lbW9yeUVudHJ5W107XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFByb2dyZXNzaXZlIERpc2Nsb3N1cmUgVHlwZXNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IHR5cGUgU2tpbGxUaWVyID0gMSB8IDIgfCAzO1xuXG5leHBvcnQgaW50ZXJmYWNlIFNraWxsTWV0YWRhdGEge1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgIHRpZXI6IFNraWxsVGllcjtcbiAgICBjYXBhYmlsaXRpZXM6IHN0cmluZ1tdO1xuICAgIHBhdGg6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTa2lsbENvbnRlbnQge1xuICAgIG1ldGFkYXRhOiBTa2lsbE1ldGFkYXRhO1xuICAgIC8qKiBUaWVyIDE6IEFsd2F5cyBsb2FkZWQgb3ZlcnZpZXcgKi9cbiAgICBvdmVydmlldzogc3RyaW5nO1xuICAgIC8qKiBUaWVyIDI6IExvYWRlZCBvbiBhY3RpdmF0aW9uICovXG4gICAgaW5zdHJ1Y3Rpb25zPzogc3RyaW5nO1xuICAgIC8qKiBUaWVyIDM6IExvYWRlZCBvbiBzcGVjaWZpYyBuZWVkICovXG4gICAgcmVzb3VyY2VzPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIExvYWRlZFNraWxsIHtcbiAgICBtZXRhZGF0YTogU2tpbGxNZXRhZGF0YTtcbiAgICBsb2FkZWRUaWVyczogU2tpbGxUaWVyW107XG4gICAgY29udGVudDogc3RyaW5nO1xuICAgIHRva2VuRXN0aW1hdGU6IG51bWJlcjtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ29udGV4dCBSZXRyaWV2YWwgVHlwZXNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IHR5cGUgUmV0cmlldmFsUGF0dGVybiA9IFwicHVzaFwiIHwgXCJwdWxsXCIgfCBcImh5YnJpZFwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbnRleHRUcmlnZ2VyIHtcbiAgICB0eXBlOlxuICAgICAgICB8IFwic2Vzc2lvbl9zdGFydFwiXG4gICAgICAgIHwgXCJmaWxlX29wZW5cIlxuICAgICAgICB8IFwiY29tbWFuZFwiXG4gICAgICAgIHwgXCJxdWVyeVwiXG4gICAgICAgIHwgXCJ0YXNrXCJcbiAgICAgICAgfCBcImNvbnZlcnNhdGlvbl90dXJuXCJcbiAgICAgICAgfCBcImZpbGVfZWRpdFwiO1xuICAgIHBhdHRlcm46IFJldHJpZXZhbFBhdHRlcm47XG4gICAgZGF0YTogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXNzZW1ibGVkQ29udGV4dCB7XG4gICAgLyoqIFNlc3Npb24gc3RhdGUgKi9cbiAgICBzZXNzaW9uPzogU2Vzc2lvbjtcbiAgICAvKiogUmVsZXZhbnQgbWVtb3JpZXMgKi9cbiAgICBtZW1vcmllczogTWVtb3J5RW50cnlbXTtcbiAgICAvKiogTG9hZGVkIHNraWxscyAqL1xuICAgIHNraWxsczogTG9hZGVkU2tpbGxbXTtcbiAgICAvKiogVG90YWwgdG9rZW4gZXN0aW1hdGUgKi9cbiAgICB0b2tlbkVzdGltYXRlOiBudW1iZXI7XG4gICAgLyoqIEFzc2VtYmx5IG1ldGFkYXRhICovXG4gICAgbWV0YToge1xuICAgICAgICBhc3NlbWJsZWRBdDogc3RyaW5nO1xuICAgICAgICB0cmlnZ2Vyczogc3RyaW5nW107XG4gICAgICAgIGR1cmF0aW9uOiBudW1iZXI7XG4gICAgfTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ29uZmlndXJhdGlvbiBUeXBlc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbnRleHRFeHBvcnRDb25maWcge1xuICAgIC8qKiBFbmFibGUgZXhwb3J0aW5nIGh1bWFuLXJlYWRhYmxlIGNvbW1hbmQgZW52ZWxvcGVzLiAqL1xuICAgIGVuYWJsZWQ/OiBib29sZWFuO1xuICAgIC8qKiBNYXJrZG93biBleHBvcnQgc2V0dGluZ3MgKi9cbiAgICBtYXJrZG93bj86IHtcbiAgICAgICAgLyoqIE91dHB1dCBkaXJlY3RvcnkgZm9yIG1hcmtkb3duIGV4cG9ydHMgKi9cbiAgICAgICAgb3V0cHV0RGlyPzogc3RyaW5nO1xuICAgIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29udGV4dENvbmZpZyB7XG4gICAgLyoqIFBhdGggdG8gY29udGV4dCBzdG9yYWdlIGRpcmVjdG9yeSAqL1xuICAgIHN0b3JhZ2VQYXRoOiBzdHJpbmc7XG4gICAgLyoqIE1heGltdW0gbWVtb3JpZXMgdG8ga2VlcCBwZXIgdHlwZSAqL1xuICAgIG1heE1lbW9yaWVzUGVyVHlwZTogbnVtYmVyO1xuICAgIC8qKiBEYXlzIGJlZm9yZSBhcmNoaXZpbmcgb2xkIHNlc3Npb25zICovXG4gICAgc2Vzc2lvbkFyY2hpdmVEYXlzOiBudW1iZXI7XG4gICAgLyoqIENvbmZpZGVuY2UgZGVjYXkgcmF0ZSBmb3IgaW5mZXJyZWQgbWVtb3JpZXMgKHBlciBkYXkpICovXG4gICAgY29uZmlkZW5jZURlY2F5UmF0ZTogbnVtYmVyO1xuICAgIC8qKiBFbmFibGUgdmVjdG9yIGVtYmVkZGluZ3MgKHJlcXVpcmVzIGV4dGVybmFsIEFQSSkgKi9cbiAgICBlbmFibGVFbWJlZGRpbmdzOiBib29sZWFuO1xuICAgIC8qKiBEZWZhdWx0IHNraWxsIHRpZXIgdG8gbG9hZCAqL1xuICAgIGRlZmF1bHRTa2lsbFRpZXI6IFNraWxsVGllcjtcbiAgICAvKiogRW5hYmxlIGF1dG9tYXRpYyBjb250ZXh0IGluZmVyZW5jZSBmcm9tIGNvbnZlcnNhdGlvbnMgYW5kIGFjdGlvbnMgKi9cbiAgICBlbmFibGVBdXRvSW5mZXJlbmNlOiBib29sZWFuO1xuICAgIC8qKiBPcHRpb25hbCBodW1hbi1yZWFkYWJsZSBleHBvcnRzICovXG4gICAgZXhwb3J0PzogQ29udGV4dEV4cG9ydENvbmZpZztcbn1cblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfQ09ORklHOiBDb250ZXh0Q29uZmlnID0ge1xuICAgIHN0b3JhZ2VQYXRoOiBcIi5haS1jb250ZXh0XCIsXG4gICAgbWF4TWVtb3JpZXNQZXJUeXBlOiAxMDAsXG4gICAgc2Vzc2lvbkFyY2hpdmVEYXlzOiAzMCxcbiAgICBjb25maWRlbmNlRGVjYXlSYXRlOiAwLjA1LFxuICAgIGVuYWJsZUVtYmVkZGluZ3M6IGZhbHNlLFxuICAgIGRlZmF1bHRTa2lsbFRpZXI6IDEsXG4gICAgZW5hYmxlQXV0b0luZmVyZW5jZTogdHJ1ZSwgLy8gRW5hYmxlIGF1dG9tYXRpYyBpbmZlcmVuY2UgYnkgZGVmYXVsdFxuICAgIGV4cG9ydDoge1xuICAgICAgICBlbmFibGVkOiBmYWxzZSxcbiAgICAgICAgbWFya2Rvd246IHtcbiAgICAgICAgICAgIG91dHB1dERpcjogXCIuYWktY29udGV4dC9leHBvcnRzXCIsXG4gICAgICAgIH0sXG4gICAgfSxcbn07XG5cbi8qKlxuICogTG9hZCBjb25maWd1cmF0aW9uIGZyb20gLmFpLWNvbnRleHQvY29uZmlnLmpzb24gaWYgaXQgZXhpc3RzXG4gKi9cbmZ1bmN0aW9uIG1lcmdlQ29udGV4dENvbmZpZyhcbiAgICBiYXNlOiBDb250ZXh0Q29uZmlnLFxuICAgIG92ZXJyaWRlcz86IFBhcnRpYWw8Q29udGV4dENvbmZpZz4sXG4pOiBDb250ZXh0Q29uZmlnIHtcbiAgICBjb25zdCBtZXJnZWQ6IENvbnRleHRDb25maWcgPSB7XG4gICAgICAgIC4uLmJhc2UsXG4gICAgICAgIC4uLm92ZXJyaWRlcyxcbiAgICAgICAgZXhwb3J0OiB7XG4gICAgICAgICAgICAuLi5iYXNlLmV4cG9ydCxcbiAgICAgICAgICAgIC4uLm92ZXJyaWRlcz8uZXhwb3J0LFxuICAgICAgICAgICAgbWFya2Rvd246IHtcbiAgICAgICAgICAgICAgICAuLi5iYXNlLmV4cG9ydD8ubWFya2Rvd24sXG4gICAgICAgICAgICAgICAgLi4ub3ZlcnJpZGVzPy5leHBvcnQ/Lm1hcmtkb3duLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIG1lcmdlZDtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvYWRDb25maWcoXG4gICAgY3VzdG9tQ29uZmlnPzogUGFydGlhbDxDb250ZXh0Q29uZmlnPixcbik6IFByb21pc2U8Q29udGV4dENvbmZpZz4ge1xuICAgIC8vIE1lcmdlIGRlZmF1bHRzICsgcGFzc2VkIGNvbmZpZyBmaXJzdCAoc28gc3RvcmFnZVBhdGggY2FuIGluZmx1ZW5jZSB3aGVyZSBjb25maWcuanNvbiBpcykuXG4gICAgY29uc3QgYmFzZUNvbmZpZyA9IG1lcmdlQ29udGV4dENvbmZpZyhERUZBVUxUX0NPTkZJRywgY3VzdG9tQ29uZmlnKTtcblxuICAgIHRyeSB7XG4gICAgICAgIC8vIFRyeSB0byBsb2FkIHByb2plY3Qtc3BlY2lmaWMgY29uZmlnXG4gICAgICAgIGNvbnN0IHsgcmVhZEZpbGUgfSA9IGF3YWl0IGltcG9ydChcIm5vZGU6ZnMvcHJvbWlzZXNcIik7XG4gICAgICAgIGNvbnN0IHsgZXhpc3RzU3luYyB9ID0gYXdhaXQgaW1wb3J0KFwibm9kZTpmc1wiKTtcbiAgICAgICAgY29uc3QgeyBqb2luIH0gPSBhd2FpdCBpbXBvcnQoXCJub2RlOnBhdGhcIik7XG5cbiAgICAgICAgY29uc3QgY29uZmlnUGF0aCA9IGpvaW4oYmFzZUNvbmZpZy5zdG9yYWdlUGF0aCwgXCJjb25maWcuanNvblwiKTtcbiAgICAgICAgaWYgKGV4aXN0c1N5bmMoY29uZmlnUGF0aCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZ0NvbnRlbnQgPSBhd2FpdCByZWFkRmlsZShjb25maWdQYXRoLCBcInV0Zi04XCIpO1xuICAgICAgICAgICAgY29uc3QgcHJvamVjdENvbmZpZyA9IEpTT04ucGFyc2UoXG4gICAgICAgICAgICAgICAgY29uZmlnQ29udGVudCxcbiAgICAgICAgICAgICkgYXMgUGFydGlhbDxDb250ZXh0Q29uZmlnPjtcbiAgICAgICAgICAgIHJldHVybiBtZXJnZUNvbnRleHRDb25maWcoYmFzZUNvbmZpZywgcHJvamVjdENvbmZpZyk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBJZ25vcmUgY29uZmlnIGxvYWRpbmcgZXJyb3JzLCB1c2UgZGVmYXVsdHNcbiAgICAgICAgY29uc3Qgc2lsZW50ID1cbiAgICAgICAgICAgIHByb2Nlc3MuZW52LkFJX0VOR19TSUxFTlQgPT09IFwiMVwiIHx8XG4gICAgICAgICAgICBwcm9jZXNzLmVudi5BSV9FTkdfU0lMRU5UID09PSBcInRydWVcIiB8fFxuICAgICAgICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwidGVzdFwiIHx8XG4gICAgICAgICAgICBwcm9jZXNzLmVudi5CVU5fVEVTVCA9PT0gXCIxXCIgfHxcbiAgICAgICAgICAgIHByb2Nlc3MuZW52LkJVTl9URVNUID09PSBcInRydWVcIjtcblxuICAgICAgICBpZiAoIXNpbGVudCkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgICAgIFwiQ291bGQgbm90IGxvYWQgY29udGV4dCBjb25maWcsIHVzaW5nIGRlZmF1bHRzOlwiLFxuICAgICAgICAgICAgICAgIGVycm9yLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBiYXNlQ29uZmlnO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDb21tYW5kIEVudmVsb3BlIFR5cGVzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCB0eXBlIENvbW1hbmRFeGVjdXRpb25TdGF0dXMgPSBcInN1Y2Nlc3NcIiB8IFwiZmFpbHVyZVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbW1hbmRDb250ZXh0RW52ZWxvcGUge1xuICAgIC8qKiBVbmlxdWUgaWQgZm9yIHRoaXMgZW52ZWxvcGUgKi9cbiAgICBpZDogc3RyaW5nO1xuICAgIC8qKiBJU08gdGltZXN0YW1wICovXG4gICAgY3JlYXRlZEF0OiBzdHJpbmc7XG4gICAgLyoqIENMSSBjb21tYW5kIG5hbWUgKGUuZy4gJ3BsYW4nLCAncmVzZWFyY2gnKSAqL1xuICAgIGNvbW1hbmROYW1lOiBzdHJpbmc7XG4gICAgLyoqIFN1Y2Nlc3MvZmFpbHVyZSAqL1xuICAgIHN0YXR1czogQ29tbWFuZEV4ZWN1dGlvblN0YXR1cztcbiAgICAvKiogRHVyYXRpb24gaW4gbWlsbGlzZWNvbmRzICovXG4gICAgZHVyYXRpb25NczogbnVtYmVyO1xuXG4gICAgLyoqIEJlc3QtZWZmb3J0IGlucHV0cy9vcHRpb25zL2FyZ3Mgc3VtbWFyeSAqL1xuICAgIGlucHV0cz86IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuXG4gICAgLyoqIEh1bWFuLXJlYWRhYmxlIHNob3J0IHN1bW1hcnkgb2Ygd2hhdCBoYXBwZW5lZCAqL1xuICAgIG91dHB1dFN1bW1hcnk/OiBzdHJpbmc7XG5cbiAgICAvKiogQmVzdC1lZmZvcnQgbGlzdCBvZiBmaWxlcyB0aGUgY29tbWFuZCB3cm90ZS9tb2RpZmllZCAobWF5IGJlIGVtcHR5KSAqL1xuICAgIGZpbGVzVG91Y2hlZD86IHN0cmluZ1tdO1xuXG4gICAgLyoqIERlY2lzaW9ucyBjYXB0dXJlZCBkdXJpbmcgZXhlY3V0aW9uICovXG4gICAgZGVjaXNpb25zPzogc3RyaW5nW107XG5cbiAgICAvKiogVGFncyBmb3IgcmV0cmlldmFsICovXG4gICAgdGFnczogc3RyaW5nW107XG5cbiAgICAvKiogT3B0aW9uYWwgc2Vzc2lvbiBpZGVudGlmaWVyICovXG4gICAgc2Vzc2lvbklkPzogc3RyaW5nO1xuXG4gICAgLyoqIE9wdGlvbmFsIHByb2plY3QgaWRlbnRpZmllciAocGF0aC9yZXBvIG5hbWUpICovXG4gICAgcHJvamVjdD86IHN0cmluZztcblxuICAgIC8qKiBFcnJvciBkZXRhaWxzIChvbmx5IHdoZW4gc3RhdHVzID09PSAnZmFpbHVyZScpICovXG4gICAgZXJyb3I/OiB7XG4gICAgICAgIG1lc3NhZ2U6IHN0cmluZztcbiAgICAgICAgbmFtZT86IHN0cmluZztcbiAgICAgICAgc3RhY2s/OiBzdHJpbmc7XG4gICAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUNvbW1hbmRFbnZlbG9wZShpbnB1dDoge1xuICAgIGNvbW1hbmROYW1lOiBzdHJpbmc7XG4gICAgc3RhdHVzOiBDb21tYW5kRXhlY3V0aW9uU3RhdHVzO1xuICAgIHN0YXJ0VGltZU1zOiBudW1iZXI7XG4gICAgZW5kVGltZU1zOiBudW1iZXI7XG4gICAgaW5wdXRzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gICAgb3V0cHV0U3VtbWFyeT86IHN0cmluZztcbiAgICBmaWxlc1RvdWNoZWQ/OiBzdHJpbmdbXTtcbiAgICBkZWNpc2lvbnM/OiBzdHJpbmdbXTtcbiAgICB0YWdzPzogc3RyaW5nW107XG4gICAgc2Vzc2lvbklkPzogc3RyaW5nO1xuICAgIHByb2plY3Q/OiBzdHJpbmc7XG4gICAgZXJyb3I/OiB1bmtub3duO1xufSk6IENvbW1hbmRDb250ZXh0RW52ZWxvcGUge1xuICAgIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBjb25zdCBpZCA9IGBlbnZfJHtEYXRlLm5vdygpLnRvU3RyaW5nKDM2KX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgOCl9YDtcblxuICAgIGxldCBlcnJvclBheWxvYWQ6IENvbW1hbmRDb250ZXh0RW52ZWxvcGVbXCJlcnJvclwiXTtcbiAgICBpZiAoaW5wdXQuZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICBlcnJvclBheWxvYWQgPSB7XG4gICAgICAgICAgICBtZXNzYWdlOiBpbnB1dC5lcnJvci5tZXNzYWdlLFxuICAgICAgICAgICAgbmFtZTogaW5wdXQuZXJyb3IubmFtZSxcbiAgICAgICAgICAgIHN0YWNrOiBpbnB1dC5lcnJvci5zdGFjayxcbiAgICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKGlucHV0LmVycm9yKSB7XG4gICAgICAgIGVycm9yUGF5bG9hZCA9IHtcbiAgICAgICAgICAgIG1lc3NhZ2U6IFN0cmluZyhpbnB1dC5lcnJvciksXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgaWQsXG4gICAgICAgIGNyZWF0ZWRBdCxcbiAgICAgICAgY29tbWFuZE5hbWU6IGlucHV0LmNvbW1hbmROYW1lLFxuICAgICAgICBzdGF0dXM6IGlucHV0LnN0YXR1cyxcbiAgICAgICAgZHVyYXRpb25NczogTWF0aC5tYXgoMCwgaW5wdXQuZW5kVGltZU1zIC0gaW5wdXQuc3RhcnRUaW1lTXMpLFxuICAgICAgICBpbnB1dHM6IGlucHV0LmlucHV0cyxcbiAgICAgICAgb3V0cHV0U3VtbWFyeTogaW5wdXQub3V0cHV0U3VtbWFyeSxcbiAgICAgICAgZmlsZXNUb3VjaGVkOiBpbnB1dC5maWxlc1RvdWNoZWQgfHwgW10sXG4gICAgICAgIGRlY2lzaW9uczogaW5wdXQuZGVjaXNpb25zIHx8IFtdLFxuICAgICAgICB0YWdzOiBBcnJheS5mcm9tKFxuICAgICAgICAgICAgbmV3IFNldChbXG4gICAgICAgICAgICAgICAgXCJjb21tYW5kLWVudmVsb3BlXCIsXG4gICAgICAgICAgICAgICAgYGNvbW1hbmQ6JHtpbnB1dC5jb21tYW5kTmFtZX1gLFxuICAgICAgICAgICAgICAgIC4uLihpbnB1dC50YWdzIHx8IFtdKSxcbiAgICAgICAgICAgIF0pLFxuICAgICAgICApLFxuICAgICAgICBzZXNzaW9uSWQ6IGlucHV0LnNlc3Npb25JZCxcbiAgICAgICAgcHJvamVjdDogaW5wdXQucHJvamVjdCxcbiAgICAgICAgZXJyb3I6IGlucHV0LnN0YXR1cyA9PT0gXCJmYWlsdXJlXCIgPyBlcnJvclBheWxvYWQgOiB1bmRlZmluZWQsXG4gICAgfTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRXZlbnQgVHlwZXNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IHR5cGUgQ29udGV4dEV2ZW50ID1cbiAgICB8IHsgdHlwZTogXCJzZXNzaW9uX2NyZWF0ZWRcIjsgc2Vzc2lvbjogU2Vzc2lvbiB9XG4gICAgfCB7IHR5cGU6IFwic2Vzc2lvbl9yZXN0b3JlZFwiOyBzZXNzaW9uOiBTZXNzaW9uIH1cbiAgICB8IHsgdHlwZTogXCJzZXNzaW9uX3VwZGF0ZWRcIjsgc2Vzc2lvbjogU2Vzc2lvbiB9XG4gICAgfCB7IHR5cGU6IFwibWVtb3J5X2FkZGVkXCI7IGVudHJ5OiBNZW1vcnlFbnRyeSB9XG4gICAgfCB7IHR5cGU6IFwibWVtb3J5X2FjY2Vzc2VkXCI7IGVudHJ5OiBNZW1vcnlFbnRyeSB9XG4gICAgfCB7IHR5cGU6IFwic2tpbGxfbG9hZGVkXCI7IHNraWxsOiBMb2FkZWRTa2lsbCB9XG4gICAgfCB7IHR5cGU6IFwiY29udGV4dF9hc3NlbWJsZWRcIjsgY29udGV4dDogQXNzZW1ibGVkQ29udGV4dCB9O1xuXG5leHBvcnQgdHlwZSBDb250ZXh0RXZlbnRIYW5kbGVyID0gKGV2ZW50OiBDb250ZXh0RXZlbnQpID0+IHZvaWQgfCBQcm9taXNlPHZvaWQ+O1xuIgogIF0sCiAgIm1hcHBpbmdzIjogIjtBQU9BO0FBQ0E7QUFDQTs7O0FDK0xPLElBQU0saUJBQWdDO0FBQUEs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QUFHLHVCQUF1QixNQUFNLFdBQVc7QUFBQSxRQUNuRyxNQUFNLEtBQUssVUFBVSxZQUFZLFNBQVM7QUFBQSxVQUN0QyxRQUFRO0FBQUEsVUFDUixTQUFTLGlCQUFpQjtBQUFBLFVBQzFCLE1BQU0sQ0FBQyxZQUFZLElBQUk7QUFBQSxRQUMzQixDQUFDO0FBQUEsUUFHRCxNQUFNLFFBQVEsS0FBSyxNQUFNLE1BQU0sUUFBUSxLQUFLO0FBQUEsUUFDNUMsSUFBSSxRQUFRLElBQUk7QUFBQSxVQUNaLEtBQUssTUFBTSxNQUFNLE9BQU8sT0FBTyxDQUFDO0FBQUEsVUFDaEM7QUFBQSxRQUNKO0FBQUEsTUFDSjtBQUFBLElBQ0o7QUFBQSxJQUVBLElBQUksV0FBVyxHQUFHO0FBQUEsTUFDZCxNQUFNLEtBQUssYUFBYTtBQUFBLElBQzVCO0FBQUEsSUFFQSxPQUFPO0FBQUE7QUFBQSxFQU1YLFVBQVUsQ0FBQyxXQUFXLEdBQVc7QUFBQSxJQUM3QixNQUFNLFFBQVEsS0FBSyxTQUFTO0FBQUEsSUFDNUIsTUFBTSxRQUFRO0FBQUEsTUFDVjtBQUFBLE1BQ0EsbUJBQW1CLE1BQU07QUFBQSxNQUN6QixrQkFBa0IsTUFBTSxPQUFPO0FBQUEsTUFDL0IsaUJBQWlCLE1BQU0sT0FBTztBQUFBLE1BQzlCLGVBQWUsTUFBTSxPQUFPO0FBQUEsTUFDNUIsdUJBQXVCLE1BQU07QUFBQSxNQUM3QjtBQUFBLElBQ0o7QUFBQSxJQUdBLE1BQU0sU0FBUyxLQUFLLGVBQWUsRUFDOUIsS0FDRyxDQUFDLEdBQUcsTUFDQSxJQUFJLEtBQUssRUFBRSxZQUFZLEVBQUUsUUFBUSxJQUNqQyxJQUFJLEtBQUssRUFBRSxZQUFZLEVBQUUsUUFBUSxDQUN6QyxFQUNDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsV0FBVyxhQUFhLEdBQUcsRUFDM0MsTUFBTSxHQUFHLFFBQVE7QUFBQSxJQUV0QixJQUFJLE9BQU8sU0FBUyxHQUFHO0FBQUEsTUFDbkIsTUFBTSxLQUFLLHFDQUFxQztBQUFBLE1BQ2hELFdBQVcsT0FBTyxRQUFRO0FBQUEsUUFDdEIsTUFBTSxLQUNGLE1BQU0sSUFBSSxTQUFTLElBQUksUUFBUSxVQUFVLEdBQUcsRUFBRSxNQUNsRDtBQUFBLE1BQ0o7QUFBQSxJQUNKO0FBQUEsSUFFQSxPQUFPLE1BQU0sS0FBSztBQUFBLENBQUk7QUFBQTtBQUU5QjtBQUdBLElBQUksaUJBQXVDO0FBRXBDLFNBQVMsZ0JBQWdCLENBQzVCLFFBQ2E7QUFBQSxFQUNiLElBQUksQ0FBQyxnQkFBZ0I7QUFBQSxJQUNqQixpQkFBaUIsSUFBSSxjQUFjLE1BQU07QUFBQSxFQUM3QztBQUFBLEVBQ0EsT0FBTztBQUFBOyIsCiAgImRlYnVnSWQiOiAiQ0M0NzA5MEE3RjlCMjJGNDY0NzU2RTIxNjQ3NTZFMjEiLAogICJuYW1lcyI6IFtdCn0=
