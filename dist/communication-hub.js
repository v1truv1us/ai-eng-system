// src/agents/communication-hub.ts
import { EventEmitter } from "node:events";

class AgentCommunicationHub extends EventEmitter {
  channels = new Map;
  activeSessions = new Map;
  pendingHandoffs = new Map;
  memoryManager;
  messageHistory = [];
  constructor(memoryManager) {
    super();
    this.memoryManager = memoryManager;
    this.setupEventHandlers();
  }
  async sendMessage(message) {
    const messageId = `msg_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`;
    const fullMessage = {
      ...message,
      id: messageId,
      timestamp: new Date
    };
    await this.storeMessage(fullMessage);
    if (message.to === "broadcast") {
      await this.broadcastMessage(fullMessage);
    } else {
      await this.deliverMessage(fullMessage);
    }
    this.emit("message_sent", fullMessage);
    return messageId;
  }
  async createCollaborationSession(taskId, participants, topic) {
    const sessionId = `session_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`;
    const session = {
      id: sessionId,
      taskId,
      participants,
      status: "active",
      startTime: new Date,
      messages: []
    };
    this.activeSessions.set(sessionId, session);
    const channelId = await this.createChannel(participants, topic);
    session.messages.push({
      id: `init_${Date.now()}`,
      from: participants[0],
      to: "broadcast",
      type: "notification",
      content: { action: "session_started", sessionId, topic },
      timestamp: new Date,
      priority: "medium"
    });
    this.emit("collaboration_started", session);
    return sessionId;
  }
  async requestHandoff(request) {
    const handoffId = `handoff_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`;
    const fullRequest = {
      ...request,
      id: handoffId,
      timestamp: new Date
    };
    this.pendingHandoffs.set(handoffId, fullRequest);
    await this.sendMessage({
      from: request.fromAgent,
      to: request.toAgent,
      type: "handoff",
      content: {
        handoffId,
        context: request.context,
        reason: request.reason
      },
      priority: request.priority,
      correlationId: handoffId
    });
    this.emit("handoff_requested", fullRequest);
    return handoffId;
  }
  async acceptHandoff(handoffId, acceptingAgent) {
    const request = this.pendingHandoffs.get(handoffId);
    if (!request) {
      throw new Error(`Handoff request ${handoffId} not found`);
    }
    await this.sendMessage({
      from: acceptingAgent,
      to: request.fromAgent,
      type: "response",
      content: { handoffId, accepted: true },
      priority: "high",
      correlationId: handoffId
    });
    this.pendingHandoffs.delete(handoffId);
    this.emit("handoff_accepted", { handoffId, acceptingAgent });
  }
  async completeSession(sessionId, outcome) {
    const session = this.activeSessions.get(sessionId);
    if (!session) {
      throw new Error(`Session ${sessionId} not found`);
    }
    session.status = "completed";
    session.endTime = new Date;
    session.outcome = outcome;
    await this.sendMessage({
      from: session.participants[0],
      to: "broadcast",
      type: "notification",
      content: {
        action: "session_completed",
        sessionId,
        outcome
      },
      priority: "medium"
    });
    this.emit("collaboration_completed", session);
  }
  getAgentMessages(agent, limit = 50) {
    return this.messageHistory.filter((msg) => msg.to === agent || msg.to === "broadcast" || msg.from === agent).sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime()).slice(0, limit);
  }
  getActiveSessions() {
    return Array.from(this.activeSessions.values()).filter((session) => session.status === "active");
  }
  getPendingHandoffs(agent) {
    return Array.from(this.pendingHandoffs.values()).filter((request) => request.toAgent === agent);
  }
  async createChannel(participants, topic) {
    const channelId = `channel_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`;
    const channel = {
      id: channelId,
      participants,
      topic,
      messages: [],
      created: new Date,
      active: true
    };
    this.channels.set(channelId, channel);
    return channelId;
  }
  async broadcastMessage(message) {
    console.log(`Broadcasting message from ${message.from}:`, message.content);
  }
  async deliverMessage(message) {
    console.log(`Delivering message from ${message.from} to ${message.to}:`, message.content);
    this.addMessageToChannels(message);
  }
  addMessageToChannels(message) {
    for (const channel of this.channels.values()) {
      if (channel.active && (channel.participants.includes(message.from) || message.to !== "broadcast" && channel.participants.includes(message.to))) {
        channel.messages.push(message);
      }
    }
    for (const session of this.activeSessions.values()) {
      if (session.participants.includes(message.from) || message.to !== "broadcast" && session.participants.includes(message.to)) {
        session.messages.push(message);
      }
    }
  }
  async storeMessage(message) {
    this.messageHistory.push(message);
    await this.memoryManager.addMemory("episodic", `Agent communication: ${message.from} -> ${message.to} (${message.type})`, {
      source: "agent",
      context: `Communication between ${message.from} and ${message.to}`,
      tags: ["communication", message.type, message.from, message.to],
      confidence: 1
    });
    if (this.messageHistory.length > 1000) {
      this.messageHistory = this.messageHistory.slice(-500);
    }
  }
  setupEventHandlers() {
    this.on("message_sent", (message) => {
      console.log(`\uD83D\uDCE8 Message sent: ${message.from} -> ${message.to} [${message.type}]`);
    });
    this.on("handoff_requested", (request) => {
      console.log(`\uD83D\uDD04 Handoff requested: ${request.fromAgent} -> ${request.toAgent} (${request.reason})`);
    });
    this.on("collaboration_started", (session) => {
      console.log(`\uD83E\uDD1D Collaboration started: ${session.participants.join(", ")} for ${session.taskId}`);
    });
    this.on("collaboration_completed", (session) => {
      console.log(`âœ… Collaboration completed: ${session.id} with outcome:`, session.outcome);
    });
  }
  getStats() {
    return {
      totalMessages: this.messageHistory.length,
      activeSessions: this.activeSessions.size,
      pendingHandoffs: this.pendingHandoffs.size,
      activeChannels: Array.from(this.channels.values()).filter((c) => c.active).length
    };
  }
}
var defaultHub = null;
function getAgentCommunicationHub(memoryManager) {
  if (!defaultHub && memoryManager) {
    defaultHub = new AgentCommunicationHub(memoryManager);
  }
  return defaultHub;
}
export {
  getAgentCommunicationHub,
  AgentCommunicationHub
};

//# debugId=4CB0033B344B922664756E2164756E21
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vc3JjL2FnZW50cy9jb21tdW5pY2F0aW9uLWh1Yi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsKICAgICIvKipcbiAqIENvbW11bmljYXRpb24gU3lzdGVtIGZvciBBZ2VudCBDb29yZGluYXRpb25cbiAqXG4gKiBQcm92aWRlcyBjaGF0cm9vbS1zdHlsZSBtZXNzYWdpbmcgYmV0d2VlbiBhZ2VudHMgZm9yIGNvbGxhYm9yYXRpb24sXG4gKiBoYW5kb2ZmIGNvb3JkaW5hdGlvbiwgYW5kIHJlYWwtdGltZSBzdGF0dXMgdXBkYXRlcy5cbiAqL1xuXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tIFwibm9kZTpldmVudHNcIjtcbmltcG9ydCB0eXBlIHsgTWVtb3J5TWFuYWdlciB9IGZyb20gXCIuLi9jb250ZXh0L21lbW9yeVwiO1xuaW1wb3J0IHR5cGUgeyBBZ2VudFR5cGUgfSBmcm9tIFwiLi90eXBlc1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50TWVzc2FnZSB7XG4gICAgaWQ6IHN0cmluZztcbiAgICBmcm9tOiBBZ2VudFR5cGU7XG4gICAgdG86IEFnZW50VHlwZSB8IFwiYnJvYWRjYXN0XCI7XG4gICAgdHlwZTpcbiAgICAgICAgfCBcInN0YXR1c1wiXG4gICAgICAgIHwgXCJyZXF1ZXN0XCJcbiAgICAgICAgfCBcInJlc3BvbnNlXCJcbiAgICAgICAgfCBcImhhbmRvZmZcIlxuICAgICAgICB8IFwibm90aWZpY2F0aW9uXCJcbiAgICAgICAgfCBcImNvbGxhYm9yYXRpb25cIjtcbiAgICBjb250ZW50OiB1bmtub3duO1xuICAgIHRpbWVzdGFtcDogRGF0ZTtcbiAgICBjb3JyZWxhdGlvbklkPzogc3RyaW5nO1xuICAgIHByaW9yaXR5OiBcImxvd1wiIHwgXCJtZWRpdW1cIiB8IFwiaGlnaFwiIHwgXCJ1cmdlbnRcIjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb21tdW5pY2F0aW9uQ2hhbm5lbCB7XG4gICAgaWQ6IHN0cmluZztcbiAgICBwYXJ0aWNpcGFudHM6IEFnZW50VHlwZVtdO1xuICAgIHRvcGljOiBzdHJpbmc7XG4gICAgbWVzc2FnZXM6IEFnZW50TWVzc2FnZVtdO1xuICAgIGNyZWF0ZWQ6IERhdGU7XG4gICAgYWN0aXZlOiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEhhbmRvZmZSZXF1ZXN0IHtcbiAgICBpZDogc3RyaW5nO1xuICAgIGZyb21BZ2VudDogQWdlbnRUeXBlO1xuICAgIHRvQWdlbnQ6IEFnZW50VHlwZTtcbiAgICBjb250ZXh0OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIHJlYXNvbjogc3RyaW5nO1xuICAgIHByaW9yaXR5OiBcImxvd1wiIHwgXCJtZWRpdW1cIiB8IFwiaGlnaFwiIHwgXCJ1cmdlbnRcIjtcbiAgICB0aW1lc3RhbXA6IERhdGU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29sbGFib3JhdGlvblNlc3Npb24ge1xuICAgIGlkOiBzdHJpbmc7XG4gICAgdGFza0lkOiBzdHJpbmc7XG4gICAgcGFydGljaXBhbnRzOiBBZ2VudFR5cGVbXTtcbiAgICBzdGF0dXM6IFwiYWN0aXZlXCIgfCBcImNvbXBsZXRlZFwiIHwgXCJmYWlsZWRcIjtcbiAgICBzdGFydFRpbWU6IERhdGU7XG4gICAgZW5kVGltZT86IERhdGU7XG4gICAgbWVzc2FnZXM6IEFnZW50TWVzc2FnZVtdO1xuICAgIG91dGNvbWU/OiB1bmtub3duO1xufVxuXG4vKipcbiAqIEFnZW50IENvbW11bmljYXRpb24gSHViXG4gKiBNYW5hZ2VzIGludGVyLWFnZW50IG1lc3NhZ2luZywgaGFuZG9mZnMsIGFuZCBjb2xsYWJvcmF0aW9uIHNlc3Npb25zXG4gKi9cbmV4cG9ydCBjbGFzcyBBZ2VudENvbW11bmljYXRpb25IdWIgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuICAgIHByaXZhdGUgY2hhbm5lbHM6IE1hcDxzdHJpbmcsIENvbW11bmljYXRpb25DaGFubmVsPiA9IG5ldyBNYXAoKTtcbiAgICBwcml2YXRlIGFjdGl2ZVNlc3Npb25zOiBNYXA8c3RyaW5nLCBDb2xsYWJvcmF0aW9uU2Vzc2lvbj4gPSBuZXcgTWFwKCk7XG4gICAgcHJpdmF0ZSBwZW5kaW5nSGFuZG9mZnM6IE1hcDxzdHJpbmcsIEhhbmRvZmZSZXF1ZXN0PiA9IG5ldyBNYXAoKTtcbiAgICBwcml2YXRlIG1lbW9yeU1hbmFnZXI6IE1lbW9yeU1hbmFnZXI7XG4gICAgcHJpdmF0ZSBtZXNzYWdlSGlzdG9yeTogQWdlbnRNZXNzYWdlW10gPSBbXTtcblxuICAgIGNvbnN0cnVjdG9yKG1lbW9yeU1hbmFnZXI6IE1lbW9yeU1hbmFnZXIpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5tZW1vcnlNYW5hZ2VyID0gbWVtb3J5TWFuYWdlcjtcbiAgICAgICAgdGhpcy5zZXR1cEV2ZW50SGFuZGxlcnMoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZW5kIGEgbWVzc2FnZSBiZXR3ZWVuIGFnZW50c1xuICAgICAqL1xuICAgIGFzeW5jIHNlbmRNZXNzYWdlKFxuICAgICAgICBtZXNzYWdlOiBPbWl0PEFnZW50TWVzc2FnZSwgXCJpZFwiIHwgXCJ0aW1lc3RhbXBcIj4sXG4gICAgKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgbWVzc2FnZUlkID0gYG1zZ18ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDgpfWA7XG4gICAgICAgIGNvbnN0IGZ1bGxNZXNzYWdlOiBBZ2VudE1lc3NhZ2UgPSB7XG4gICAgICAgICAgICAuLi5tZXNzYWdlLFxuICAgICAgICAgICAgaWQ6IG1lc3NhZ2VJZCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBTdG9yZSBpbiBtZW1vcnlcbiAgICAgICAgYXdhaXQgdGhpcy5zdG9yZU1lc3NhZ2UoZnVsbE1lc3NhZ2UpO1xuXG4gICAgICAgIC8vIEhhbmRsZSBiYXNlZCBvbiB0eXBlXG4gICAgICAgIGlmIChtZXNzYWdlLnRvID09PSBcImJyb2FkY2FzdFwiKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmJyb2FkY2FzdE1lc3NhZ2UoZnVsbE1lc3NhZ2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5kZWxpdmVyTWVzc2FnZShmdWxsTWVzc2FnZSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVtaXQoXCJtZXNzYWdlX3NlbnRcIiwgZnVsbE1lc3NhZ2UpO1xuICAgICAgICByZXR1cm4gbWVzc2FnZUlkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIGNvbGxhYm9yYXRpb24gc2Vzc2lvbiBmb3IgbXVsdGktYWdlbnQgdGFza3NcbiAgICAgKi9cbiAgICBhc3luYyBjcmVhdGVDb2xsYWJvcmF0aW9uU2Vzc2lvbihcbiAgICAgICAgdGFza0lkOiBzdHJpbmcsXG4gICAgICAgIHBhcnRpY2lwYW50czogQWdlbnRUeXBlW10sXG4gICAgICAgIHRvcGljOiBzdHJpbmcsXG4gICAgKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbklkID0gYHNlc3Npb25fJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCA4KX1gO1xuXG4gICAgICAgIGNvbnN0IHNlc3Npb246IENvbGxhYm9yYXRpb25TZXNzaW9uID0ge1xuICAgICAgICAgICAgaWQ6IHNlc3Npb25JZCxcbiAgICAgICAgICAgIHRhc2tJZCxcbiAgICAgICAgICAgIHBhcnRpY2lwYW50cyxcbiAgICAgICAgICAgIHN0YXR1czogXCJhY3RpdmVcIixcbiAgICAgICAgICAgIHN0YXJ0VGltZTogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSxcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmFjdGl2ZVNlc3Npb25zLnNldChzZXNzaW9uSWQsIHNlc3Npb24pO1xuXG4gICAgICAgIC8vIENyZWF0ZSBjb21tdW5pY2F0aW9uIGNoYW5uZWxcbiAgICAgICAgY29uc3QgY2hhbm5lbElkID0gYXdhaXQgdGhpcy5jcmVhdGVDaGFubmVsKHBhcnRpY2lwYW50cywgdG9waWMpO1xuICAgICAgICBzZXNzaW9uLm1lc3NhZ2VzLnB1c2goe1xuICAgICAgICAgICAgaWQ6IGBpbml0XyR7RGF0ZS5ub3coKX1gLFxuICAgICAgICAgICAgZnJvbTogcGFydGljaXBhbnRzWzBdLCAvLyBDb29yZGluYXRvclxuICAgICAgICAgICAgdG86IFwiYnJvYWRjYXN0XCIsXG4gICAgICAgICAgICB0eXBlOiBcIm5vdGlmaWNhdGlvblwiLFxuICAgICAgICAgICAgY29udGVudDogeyBhY3Rpb246IFwic2Vzc2lvbl9zdGFydGVkXCIsIHNlc3Npb25JZCwgdG9waWMgfSxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIHByaW9yaXR5OiBcIm1lZGl1bVwiLFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmVtaXQoXCJjb2xsYWJvcmF0aW9uX3N0YXJ0ZWRcIiwgc2Vzc2lvbik7XG4gICAgICAgIHJldHVybiBzZXNzaW9uSWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVxdWVzdCBhIGhhbmRvZmYgYmV0d2VlbiBhZ2VudHNcbiAgICAgKi9cbiAgICBhc3luYyByZXF1ZXN0SGFuZG9mZihcbiAgICAgICAgcmVxdWVzdDogT21pdDxIYW5kb2ZmUmVxdWVzdCwgXCJpZFwiIHwgXCJ0aW1lc3RhbXBcIj4sXG4gICAgKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgaGFuZG9mZklkID0gYGhhbmRvZmZfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCA4KX1gO1xuICAgICAgICBjb25zdCBmdWxsUmVxdWVzdDogSGFuZG9mZlJlcXVlc3QgPSB7XG4gICAgICAgICAgICAuLi5yZXF1ZXN0LFxuICAgICAgICAgICAgaWQ6IGhhbmRvZmZJZCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnBlbmRpbmdIYW5kb2Zmcy5zZXQoaGFuZG9mZklkLCBmdWxsUmVxdWVzdCk7XG5cbiAgICAgICAgLy8gU2VuZCBoYW5kb2ZmIG1lc3NhZ2VcbiAgICAgICAgYXdhaXQgdGhpcy5zZW5kTWVzc2FnZSh7XG4gICAgICAgICAgICBmcm9tOiByZXF1ZXN0LmZyb21BZ2VudCxcbiAgICAgICAgICAgIHRvOiByZXF1ZXN0LnRvQWdlbnQsXG4gICAgICAgICAgICB0eXBlOiBcImhhbmRvZmZcIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgICBoYW5kb2ZmSWQsXG4gICAgICAgICAgICAgICAgY29udGV4dDogcmVxdWVzdC5jb250ZXh0LFxuICAgICAgICAgICAgICAgIHJlYXNvbjogcmVxdWVzdC5yZWFzb24sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHJpb3JpdHk6IHJlcXVlc3QucHJpb3JpdHksXG4gICAgICAgICAgICBjb3JyZWxhdGlvbklkOiBoYW5kb2ZmSWQsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuZW1pdChcImhhbmRvZmZfcmVxdWVzdGVkXCIsIGZ1bGxSZXF1ZXN0KTtcbiAgICAgICAgcmV0dXJuIGhhbmRvZmZJZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBY2NlcHQgYSBoYW5kb2ZmIHJlcXVlc3RcbiAgICAgKi9cbiAgICBhc3luYyBhY2NlcHRIYW5kb2ZmKFxuICAgICAgICBoYW5kb2ZmSWQ6IHN0cmluZyxcbiAgICAgICAgYWNjZXB0aW5nQWdlbnQ6IEFnZW50VHlwZSxcbiAgICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHRoaXMucGVuZGluZ0hhbmRvZmZzLmdldChoYW5kb2ZmSWQpO1xuICAgICAgICBpZiAoIXJlcXVlc3QpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSGFuZG9mZiByZXF1ZXN0ICR7aGFuZG9mZklkfSBub3QgZm91bmRgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNlbmQgYWNjZXB0YW5jZSBtZXNzYWdlXG4gICAgICAgIGF3YWl0IHRoaXMuc2VuZE1lc3NhZ2Uoe1xuICAgICAgICAgICAgZnJvbTogYWNjZXB0aW5nQWdlbnQsXG4gICAgICAgICAgICB0bzogcmVxdWVzdC5mcm9tQWdlbnQsXG4gICAgICAgICAgICB0eXBlOiBcInJlc3BvbnNlXCIsXG4gICAgICAgICAgICBjb250ZW50OiB7IGhhbmRvZmZJZCwgYWNjZXB0ZWQ6IHRydWUgfSxcbiAgICAgICAgICAgIHByaW9yaXR5OiBcImhpZ2hcIixcbiAgICAgICAgICAgIGNvcnJlbGF0aW9uSWQ6IGhhbmRvZmZJZCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5wZW5kaW5nSGFuZG9mZnMuZGVsZXRlKGhhbmRvZmZJZCk7XG4gICAgICAgIHRoaXMuZW1pdChcImhhbmRvZmZfYWNjZXB0ZWRcIiwgeyBoYW5kb2ZmSWQsIGFjY2VwdGluZ0FnZW50IH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbXBsZXRlIGEgY29sbGFib3JhdGlvbiBzZXNzaW9uXG4gICAgICovXG4gICAgYXN5bmMgY29tcGxldGVTZXNzaW9uKHNlc3Npb25JZDogc3RyaW5nLCBvdXRjb21lPzogYW55KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzLmFjdGl2ZVNlc3Npb25zLmdldChzZXNzaW9uSWQpO1xuICAgICAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgU2Vzc2lvbiAke3Nlc3Npb25JZH0gbm90IGZvdW5kYCk7XG4gICAgICAgIH1cblxuICAgICAgICBzZXNzaW9uLnN0YXR1cyA9IFwiY29tcGxldGVkXCI7XG4gICAgICAgIHNlc3Npb24uZW5kVGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHNlc3Npb24ub3V0Y29tZSA9IG91dGNvbWU7XG5cbiAgICAgICAgLy8gU2VuZCBjb21wbGV0aW9uIG1lc3NhZ2VcbiAgICAgICAgYXdhaXQgdGhpcy5zZW5kTWVzc2FnZSh7XG4gICAgICAgICAgICBmcm9tOiBzZXNzaW9uLnBhcnRpY2lwYW50c1swXSwgLy8gQ29vcmRpbmF0b3JcbiAgICAgICAgICAgIHRvOiBcImJyb2FkY2FzdFwiLFxuICAgICAgICAgICAgdHlwZTogXCJub3RpZmljYXRpb25cIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgICBhY3Rpb246IFwic2Vzc2lvbl9jb21wbGV0ZWRcIixcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgb3V0Y29tZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcmlvcml0eTogXCJtZWRpdW1cIixcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5lbWl0KFwiY29sbGFib3JhdGlvbl9jb21wbGV0ZWRcIiwgc2Vzc2lvbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IG1lc3NhZ2VzIGZvciBhbiBhZ2VudFxuICAgICAqL1xuICAgIGdldEFnZW50TWVzc2FnZXMoYWdlbnQ6IEFnZW50VHlwZSwgbGltaXQgPSA1MCk6IEFnZW50TWVzc2FnZVtdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWVzc2FnZUhpc3RvcnlcbiAgICAgICAgICAgIC5maWx0ZXIoXG4gICAgICAgICAgICAgICAgKG1zZykgPT5cbiAgICAgICAgICAgICAgICAgICAgbXNnLnRvID09PSBhZ2VudCB8fFxuICAgICAgICAgICAgICAgICAgICBtc2cudG8gPT09IFwiYnJvYWRjYXN0XCIgfHxcbiAgICAgICAgICAgICAgICAgICAgbXNnLmZyb20gPT09IGFnZW50LFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLnNvcnQoKGEsIGIpID0+IGIudGltZXN0YW1wLmdldFRpbWUoKSAtIGEudGltZXN0YW1wLmdldFRpbWUoKSlcbiAgICAgICAgICAgIC5zbGljZSgwLCBsaW1pdCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGFjdGl2ZSBjb2xsYWJvcmF0aW9uIHNlc3Npb25zXG4gICAgICovXG4gICAgZ2V0QWN0aXZlU2Vzc2lvbnMoKTogQ29sbGFib3JhdGlvblNlc3Npb25bXSB7XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuYWN0aXZlU2Vzc2lvbnMudmFsdWVzKCkpLmZpbHRlcihcbiAgICAgICAgICAgIChzZXNzaW9uKSA9PiBzZXNzaW9uLnN0YXR1cyA9PT0gXCJhY3RpdmVcIixcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgcGVuZGluZyBoYW5kb2ZmcyBmb3IgYW4gYWdlbnRcbiAgICAgKi9cbiAgICBnZXRQZW5kaW5nSGFuZG9mZnMoYWdlbnQ6IEFnZW50VHlwZSk6IEhhbmRvZmZSZXF1ZXN0W10ge1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnBlbmRpbmdIYW5kb2Zmcy52YWx1ZXMoKSkuZmlsdGVyKFxuICAgICAgICAgICAgKHJlcXVlc3QpID0+IHJlcXVlc3QudG9BZ2VudCA9PT0gYWdlbnQsXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBjcmVhdGVDaGFubmVsKFxuICAgICAgICBwYXJ0aWNpcGFudHM6IEFnZW50VHlwZVtdLFxuICAgICAgICB0b3BpYzogc3RyaW5nLFxuICAgICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IGNoYW5uZWxJZCA9IGBjaGFubmVsXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgOCl9YDtcblxuICAgICAgICBjb25zdCBjaGFubmVsOiBDb21tdW5pY2F0aW9uQ2hhbm5lbCA9IHtcbiAgICAgICAgICAgIGlkOiBjaGFubmVsSWQsXG4gICAgICAgICAgICBwYXJ0aWNpcGFudHMsXG4gICAgICAgICAgICB0b3BpYyxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSxcbiAgICAgICAgICAgIGNyZWF0ZWQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBhY3RpdmU6IHRydWUsXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5jaGFubmVscy5zZXQoY2hhbm5lbElkLCBjaGFubmVsKTtcbiAgICAgICAgcmV0dXJuIGNoYW5uZWxJZDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIGJyb2FkY2FzdE1lc3NhZ2UobWVzc2FnZTogQWdlbnRNZXNzYWdlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIC8vIEluIGEgcmVhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3b3VsZCBzZW5kIHRvIGFsbCByZWxldmFudCBhZ2VudHNcbiAgICAgICAgLy8gRm9yIG5vdywganVzdCBsb2cgYW5kIHN0b3JlXG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgYEJyb2FkY2FzdGluZyBtZXNzYWdlIGZyb20gJHttZXNzYWdlLmZyb219OmAsXG4gICAgICAgICAgICBtZXNzYWdlLmNvbnRlbnQsXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBkZWxpdmVyTWVzc2FnZShtZXNzYWdlOiBBZ2VudE1lc3NhZ2UpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIGRlbGl2ZXIgdG8gdGhlIHNwZWNpZmljIGFnZW50XG4gICAgICAgIC8vIEZvciBub3csIGp1c3QgbG9nIGFuZCBzdG9yZVxuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgIGBEZWxpdmVyaW5nIG1lc3NhZ2UgZnJvbSAke21lc3NhZ2UuZnJvbX0gdG8gJHttZXNzYWdlLnRvfTpgLFxuICAgICAgICAgICAgbWVzc2FnZS5jb250ZW50LFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIEFkZCB0byByZWxldmFudCBjaGFubmVscy9zZXNzaW9uc1xuICAgICAgICB0aGlzLmFkZE1lc3NhZ2VUb0NoYW5uZWxzKG1lc3NhZ2UpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYWRkTWVzc2FnZVRvQ2hhbm5lbHMobWVzc2FnZTogQWdlbnRNZXNzYWdlKTogdm9pZCB7XG4gICAgICAgIGZvciAoY29uc3QgY2hhbm5lbCBvZiB0aGlzLmNoYW5uZWxzLnZhbHVlcygpKSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgY2hhbm5lbC5hY3RpdmUgJiZcbiAgICAgICAgICAgICAgICAoY2hhbm5lbC5wYXJ0aWNpcGFudHMuaW5jbHVkZXMobWVzc2FnZS5mcm9tKSB8fFxuICAgICAgICAgICAgICAgICAgICAobWVzc2FnZS50byAhPT0gXCJicm9hZGNhc3RcIiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhbm5lbC5wYXJ0aWNpcGFudHMuaW5jbHVkZXMobWVzc2FnZS50byBhcyBBZ2VudFR5cGUpKSlcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGNoYW5uZWwubWVzc2FnZXMucHVzaChtZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFkZCB0byBjb2xsYWJvcmF0aW9uIHNlc3Npb25zXG4gICAgICAgIGZvciAoY29uc3Qgc2Vzc2lvbiBvZiB0aGlzLmFjdGl2ZVNlc3Npb25zLnZhbHVlcygpKSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgc2Vzc2lvbi5wYXJ0aWNpcGFudHMuaW5jbHVkZXMobWVzc2FnZS5mcm9tKSB8fFxuICAgICAgICAgICAgICAgIChtZXNzYWdlLnRvICE9PSBcImJyb2FkY2FzdFwiICYmXG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb24ucGFydGljaXBhbnRzLmluY2x1ZGVzKG1lc3NhZ2UudG8gYXMgQWdlbnRUeXBlKSlcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIHNlc3Npb24ubWVzc2FnZXMucHVzaChtZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgc3RvcmVNZXNzYWdlKG1lc3NhZ2U6IEFnZW50TWVzc2FnZSk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICB0aGlzLm1lc3NhZ2VIaXN0b3J5LnB1c2gobWVzc2FnZSk7XG5cbiAgICAgICAgLy8gU3RvcmUgaW4gbWVtb3J5IHN5c3RlbVxuICAgICAgICBhd2FpdCB0aGlzLm1lbW9yeU1hbmFnZXIuYWRkTWVtb3J5KFxuICAgICAgICAgICAgXCJlcGlzb2RpY1wiLFxuICAgICAgICAgICAgYEFnZW50IGNvbW11bmljYXRpb246ICR7bWVzc2FnZS5mcm9tfSAtPiAke21lc3NhZ2UudG99ICgke21lc3NhZ2UudHlwZX0pYCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzb3VyY2U6IFwiYWdlbnRcIixcbiAgICAgICAgICAgICAgICBjb250ZXh0OiBgQ29tbXVuaWNhdGlvbiBiZXR3ZWVuICR7bWVzc2FnZS5mcm9tfSBhbmQgJHttZXNzYWdlLnRvfWAsXG4gICAgICAgICAgICAgICAgdGFnczogW1wiY29tbXVuaWNhdGlvblwiLCBtZXNzYWdlLnR5cGUsIG1lc3NhZ2UuZnJvbSwgbWVzc2FnZS50b10sXG4gICAgICAgICAgICAgICAgY29uZmlkZW5jZTogMS4wLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBLZWVwIG9ubHkgcmVjZW50IG1lc3NhZ2VzXG4gICAgICAgIGlmICh0aGlzLm1lc3NhZ2VIaXN0b3J5Lmxlbmd0aCA+IDEwMDApIHtcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZUhpc3RvcnkgPSB0aGlzLm1lc3NhZ2VIaXN0b3J5LnNsaWNlKC01MDApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXR1cEV2ZW50SGFuZGxlcnMoKTogdm9pZCB7XG4gICAgICAgIHRoaXMub24oXCJtZXNzYWdlX3NlbnRcIiwgKG1lc3NhZ2U6IEFnZW50TWVzc2FnZSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICAgICAgYPCfk6ggTWVzc2FnZSBzZW50OiAke21lc3NhZ2UuZnJvbX0gLT4gJHttZXNzYWdlLnRvfSBbJHttZXNzYWdlLnR5cGV9XWAsXG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLm9uKFwiaGFuZG9mZl9yZXF1ZXN0ZWRcIiwgKHJlcXVlc3Q6IEhhbmRvZmZSZXF1ZXN0KSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgICBg8J+UhCBIYW5kb2ZmIHJlcXVlc3RlZDogJHtyZXF1ZXN0LmZyb21BZ2VudH0gLT4gJHtyZXF1ZXN0LnRvQWdlbnR9ICgke3JlcXVlc3QucmVhc29ufSlgLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5vbihcImNvbGxhYm9yYXRpb25fc3RhcnRlZFwiLCAoc2Vzc2lvbjogQ29sbGFib3JhdGlvblNlc3Npb24pID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgICAgIGDwn6SdIENvbGxhYm9yYXRpb24gc3RhcnRlZDogJHtzZXNzaW9uLnBhcnRpY2lwYW50cy5qb2luKFwiLCBcIil9IGZvciAke3Nlc3Npb24udGFza0lkfWAsXG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLm9uKFwiY29sbGFib3JhdGlvbl9jb21wbGV0ZWRcIiwgKHNlc3Npb246IENvbGxhYm9yYXRpb25TZXNzaW9uKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgICBg4pyFIENvbGxhYm9yYXRpb24gY29tcGxldGVkOiAke3Nlc3Npb24uaWR9IHdpdGggb3V0Y29tZTpgLFxuICAgICAgICAgICAgICAgIHNlc3Npb24ub3V0Y29tZSxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBjb21tdW5pY2F0aW9uIHN0YXRpc3RpY3NcbiAgICAgKi9cbiAgICBnZXRTdGF0cygpOiB7XG4gICAgICAgIHRvdGFsTWVzc2FnZXM6IG51bWJlcjtcbiAgICAgICAgYWN0aXZlU2Vzc2lvbnM6IG51bWJlcjtcbiAgICAgICAgcGVuZGluZ0hhbmRvZmZzOiBudW1iZXI7XG4gICAgICAgIGFjdGl2ZUNoYW5uZWxzOiBudW1iZXI7XG4gICAgfSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0b3RhbE1lc3NhZ2VzOiB0aGlzLm1lc3NhZ2VIaXN0b3J5Lmxlbmd0aCxcbiAgICAgICAgICAgIGFjdGl2ZVNlc3Npb25zOiB0aGlzLmFjdGl2ZVNlc3Npb25zLnNpemUsXG4gICAgICAgICAgICBwZW5kaW5nSGFuZG9mZnM6IHRoaXMucGVuZGluZ0hhbmRvZmZzLnNpemUsXG4gICAgICAgICAgICBhY3RpdmVDaGFubmVsczogQXJyYXkuZnJvbSh0aGlzLmNoYW5uZWxzLnZhbHVlcygpKS5maWx0ZXIoXG4gICAgICAgICAgICAgICAgKGMpID0+IGMuYWN0aXZlLFxuICAgICAgICAgICAgKS5sZW5ndGgsXG4gICAgICAgIH07XG4gICAgfVxufVxuXG4vKipcbiAqIFNpbmdsZXRvbiBpbnN0YW5jZVxuICovXG5sZXQgZGVmYXVsdEh1YjogQWdlbnRDb21tdW5pY2F0aW9uSHViIHwgbnVsbCA9IG51bGw7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBZ2VudENvbW11bmljYXRpb25IdWIoXG4gICAgbWVtb3J5TWFuYWdlcj86IE1lbW9yeU1hbmFnZXIsXG4pOiBBZ2VudENvbW11bmljYXRpb25IdWIge1xuICAgIGlmICghZGVmYXVsdEh1YiAmJiBtZW1vcnlNYW5hZ2VyKSB7XG4gICAgICAgIGRlZmF1bHRIdWIgPSBuZXcgQWdlbnRDb21tdW5pY2F0aW9uSHViKG1lbW9yeU1hbmFnZXIpO1xuICAgIH1cbiAg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USxTQUNoRjtBQUFBLEtBQ0g7QUFBQSxJQUVELEtBQUssR0FBRyx5QkFBeUIsQ0FBQyxZQUFrQztBQUFBLE1BQ2hFLFFBQVEsSUFDSix1Q0FBNEIsUUFBUSxhQUFhLEtBQUssSUFBSSxTQUFTLFFBQVEsUUFDL0U7QUFBQSxLQUNIO0FBQUEsSUFFRCxLQUFLLEdBQUcsMkJBQTJCLENBQUMsWUFBa0M7QUFBQSxNQUNsRSxRQUFRLElBQ0osOEJBQTZCLFFBQVEsb0JBQ3JDLFFBQVEsT0FDWjtBQUFBLEtBQ0g7QUFBQTtBQUFBLEVBTUwsUUFBUSxHQUtOO0FBQUEsSUFDRSxPQUFPO0FBQUEsTUFDSCxlQUFlLEtBQUssZUFBZTtBQUFBLE1BQ25DLGdCQUFnQixLQUFLLGVBQWU7QUFBQSxNQUNwQyxpQkFBaUIsS0FBSyxnQkFBZ0I7QUFBQSxNQUN0QyxnQkFBZ0IsTUFBTSxLQUFLLEtBQUssU0FBUyxPQUFPLENBQUMsRUFBRSxPQUMvQyxDQUFDLE1BQU0sRUFBRSxNQUNiLEVBQUU7QUFBQSxJQUNOO0FBQUE7QUFFUjtBQUtBLElBQUksYUFBMkM7QUFFeEMsU0FBUyx3QkFBd0IsQ0FDcEMsZUFDcUI7QUFBQSxFQUNyQixJQUFJLENBQUMsY0FBYyxlQUFlO0FBQUEsSUFDOUIsYUFBYSxJQUFJLHNCQUFzQixhQUFhO0FBQUEsRUFDeEQ7QUFBQSxFQUNBLE9BQU87QUFBQTsiLAogICJkZWJ1Z0lkIjogIjRDQjAwMzNCMzQ0QjkyMjY2NDc1NkUyMTY0NzU2RTIxIiwKICAibmFtZXMiOiBbXQp9
