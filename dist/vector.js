// src/context/vector.ts
import { existsSync } from "node:fs";
import { mkdir, readFile, writeFile } from "node:fs/promises";
import { join } from "node:path";

// src/context/types.ts
var DEFAULT_CONFIG = {
  storagePath: ".ai-context",
  maxMemoriesPerType: 100,
  sessionArchiveDays: 30,
  confidenceDecayRate: 0.05,
  enableEmbeddings: false,
  defaultSkillTier: 1,
  enableAutoInference: true,
  export: {
    enabled: false,
    markdown: {
      outputDir: ".ai-context/exports"
    }
  }
};

// src/context/vector.ts
class TextTokenizer {
  tokenize(text) {
    return text.toLowerCase().replace(/[^\w\s]/g, "").split(/\s+/).filter((word) => word.length > 0);
  }
  createTFIDFVector(texts) {
    const allWords = new Set;
    const documents = [];
    for (const text of texts) {
      const words2 = this.tokenize(text);
      documents.push(words2);
      words2.forEach((word) => allWords.add(word));
    }
    const wordList = Array.from(allWords);
    const docFrequency = new Map;
    for (const word of wordList) {
      const docCount = documents.filter((doc) => doc.includes(word)).length;
      const idf = Math.log(texts.length / (docCount + 1));
      docFrequency.set(word, idf);
    }
    const vector = new Map;
    const words = this.tokenize(texts[0]);
    const wordCount = words.length;
    for (const word of words) {
      const tf = words.filter((w) => w === word).length / wordCount;
      const tfidf = tf * (docFrequency.get(word) || 0);
      vector.set(word, tfidf);
    }
    return vector;
  }
  createFrequencyVector(text) {
    const words = this.tokenize(text);
    const vector = new Map;
    const totalWords = words.length;
    for (const word of words) {
      const count = (vector.get(word) || 0) + 1;
      vector.set(word, count / totalWords);
    }
    return vector;
  }
}

class VectorMath {
  static cosineSimilarity(vec1, vec2) {
    const intersection = new Set([...vec1.keys()].filter((x) => vec2.has(x)));
    if (intersection.size === 0)
      return 0;
    let dotProduct = 0;
    let mag1 = 0;
    let mag2 = 0;
    for (const word of intersection) {
      dotProduct += (vec1.get(word) || 0) * (vec2.get(word) || 0);
    }
    for (const value of vec1.values()) {
      mag1 += value * value;
    }
    for (const value of vec2.values()) {
      mag2 += value * value;
    }
    mag1 = Math.sqrt(mag1);
    mag2 = Math.sqrt(mag2);
    return mag1 === 0 || mag2 === 0 ? 0 : dotProduct / (mag1 * mag2);
  }
  static euclideanDistance(vec1, vec2) {
    if (vec1.length !== vec2.length)
      return Number.POSITIVE_INFINITY;
    let sum = 0;
    for (let i = 0;i < vec1.length; i++) {
      const diff = vec1[i] - vec2[i];
      sum += diff * diff;
    }
    return Math.sqrt(sum);
  }
  static mapToArray(map, dimension) {
    const array = new Array(dimension).fill(0);
    let i = 0;
    for (const [word, value] of map.entries()) {
      if (i >= dimension)
        break;
      array[i] = value;
      i++;
    }
    return array;
  }
}

class VectorMemoryManager {
  config;
  vectorDir;
  store;
  tokenizer;
  constructor(config = {}) {
    this.config = { ...DEFAULT_CONFIG, ...config };
    this.vectorDir = join(this.config.storagePath, "vectors");
    this.store = { embeddings: [], dimension: 0, indexType: "flat" };
    this.tokenizer = new TextTokenizer;
  }
  async initialize() {
    await mkdir(this.vectorDir, { recursive: true });
    await this.loadVectorStore();
  }
  async loadVectorStore() {
    const storePath = join(this.vectorDir, "store.json");
    if (existsSync(storePath)) {
      try {
        const content = await readFile(storePath, "utf-8");
        this.store = JSON.parse(content);
      } catch (error) {
        console.error("Failed to load vector store:", error);
      }
    }
  }
  async saveVectorStore() {
    const storePath = join(this.vectorDir, "store.json");
    await writeFile(storePath, JSON.stringify(this.store, null, 2));
  }
  async createEmbedding(memory) {
    const vector = this.tokenizer.createFrequencyVector(memory.content);
    const vectorArray = VectorMath.mapToArray(vector, this.store.dimension || 100);
    const embedding = {
      id: `vec_${Date.now().toString(36)}_${Math.random().toString(36).substring(2, 8)}`,
      vector: vectorArray,
      metadata: {
        memoryId: memory.id,
        type: memory.type,
        tags: memory.tags,
        timestamp: memory.provenance.timestamp
      }
    };
    if (this.store.dimension === 0) {
      this.store.dimension = vectorArray.length;
    }
    return embedding;
  }
  async addMemoryWithVector(memory) {
    const embedding = await this.createEmbedding(memory);
    this.store.embeddings.push(embedding);
    await this.saveVectorStore();
  }
  async semanticSearch(query, options = {}) {
    const queryVector = this.tokenizer.createFrequencyVector(query);
    const queryArray = VectorMath.mapToArray(queryVector, this.store.dimension);
    const results = [];
    for (const embedding of this.store.embeddings) {
      if (options.memoryType && embedding.metadata.type !== options.memoryType) {
        continue;
      }
      if (options.tags && options.tags.length > 0) {
        const hasTag = options.tags.some((tag) => embedding.metadata.tags.includes(tag));
        if (!hasTag)
          continue;
      }
      const similarity = VectorMath.cosineSimilarity(new Map(Object.entries(queryVector)), new Map(Object.entries(this.tokenizer.createFrequencyVector(embedding.metadata.memoryId || ""))));
      if (similarity >= (options.minScore || 0.1)) {
        results.push({
          score: similarity,
          relevance: this.getRelevanceLabel(similarity),
          memory: {
            id: embedding.metadata.memoryId,
            type: embedding.metadata.type,
            content: "",
            provenance: {
              source: "user",
              timestamp: embedding.metadata.timestamp,
              confidence: 1,
              context: ""
            },
            tags: embedding.metadata.tags,
            lastAccessed: new Date().toISOString(),
            accessCount: 0
          }
        });
      }
    }
    results.sort((a, b) => b.score - a.score);
    return results.slice(0, options.limit || 10);
  }
  getRelevanceLabel(score) {
    if (score >= 0.8)
      return "Very High";
    if (score >= 0.6)
      return "High";
    if (score >= 0.4)
      return "Medium";
    if (score >= 0.2)
      return "Low";
    return "Very Low";
  }
  getStats() {
    const norms = this.store.embeddings.map((e) => Math.sqrt(e.vector.reduce((sum, val) => sum + val * val, 0)));
    return {
      totalEmbeddings: this.store.embeddings.length,
      dimension: this.store.dimension,
      indexType: this.store.indexType,
      averageVectorNorm: norms.reduce((sum, norm) => sum + norm, 0) / norms.length
    };
  }
  async rebuildIndex() {
    console.log("Rebuilding vector index...");
    this.store.embeddings.sort((a, b) => a.metadata.memoryId.localeCompare(b.metadata.memoryId));
    await this.saveVectorStore();
    console.log(`Rebuilt index with ${this.store.embeddings.length} embeddings`);
  }
  async exportVectors(format = "json") {
    if (format === "json") {
      return JSON.stringify(this.store, null, 2);
    }
    const headers = [
      "id",
      "memoryId",
      "type",
      "tags",
      "timestamp",
      "dimension"
    ];
    const rows = this.store.embeddings.map((e) => [
      e.id,
      e.metadata.memoryId,
      e.metadata.type,
      e.metadata.tags.join(";"),
      e.metadata.timestamp,
      e.vector.length
    ]);
    return [headers.join(","), ...rows.map((row) => row.join(","))].join(`
`);
  }
}

class ContextRanker {
  static rankByRelevance(memories, context) {
    const scored = memories.map((memory) => {
      let score = 0;
      if (context.query) {
        const queryWords = context.query.toLowerCase().split(/\s+/);
        const contentWords = memory.content.toLowerCase().split(/\s+/);
        const overlap = queryWords.filter((word) => contentWords.includes(word)).length;
        score += overlap / queryWords.length * 0.4;
      }
      if (context.activeFiles && context.activeFiles.length > 0) {
        const fileMention = context.activeFiles.some((file) => memory.content.toLowerCase().includes(file.toLowerCase()));
        if (fileMention)
          score += 0.3;
      }
      if (context.currentTask) {
        const taskRelevance = memory.content.toLowerCase().includes(context.currentTask.toLowerCase());
        if (taskRelevance)
          score += 0.2;
      }
      const daysSinceAccess = (Date.now() - new Date(memory.lastAccessed).getTime()) / (1000 * 60 * 60 * 24);
      const recencyScore = Math.max(0, 1 - daysSinceAccess / 30);
      score += recencyScore * 0.1;
      score += memory.provenance.confidence * 0.1;
      return { memory, score };
    });
    scored.sort((a, b) => b.score - a.score);
    return scored.map((item) => item.memory);
  }
  static getRankingExplanation(memory, score) {
    const factors = [];
    if (score > 0.5)
      factors.push("High relevance to query");
    if (memory.provenance.confidence > 0.8)
      factors.push("High confidence");
    if (memory.tags.includes("recent"))
      factors.push("Recently accessed");
    if (memory.accessCount > 5)
      factors.push("Frequently accessed");
    return factors.length > 0 ? factors.join(", ") : "Base relevance";
  }
}
export {
  VectorMemoryManager,
  VectorMath,
  TextTokenizer,
  ContextRanker
};

//# debugId=1E2D71BF28F522DF64756E2164756E21
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vc3JjL2NvbnRleHQvdmVjdG9yLnRzIiwgIi4uL3NyYy9jb250ZXh0L3R5cGVzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWwogICAgIi8qKlxuICogVmVjdG9yIFNlYXJjaCBhbmQgU2VtYW50aWMgTWVtb3J5XG4gKlxuICogSW1wbGVtZW50cyB2ZWN0b3IgZW1iZWRkaW5ncyBhbmQgc2VtYW50aWMgc2VhcmNoIGZvciBlbmhhbmNlZCBjb250ZXh0IHJldHJpZXZhbC5cbiAqIFVzZXMgbG9jYWwgdmVjdG9yIHN0b3JlIHdpdGggb3B0aW9uYWwgZXh0ZXJuYWwgZW1iZWRkaW5nIHNlcnZpY2VzLlxuICovXG5cbmltcG9ydCB7IGV4aXN0c1N5bmMgfSBmcm9tIFwibm9kZTpmc1wiO1xuaW1wb3J0IHsgbWtkaXIsIHJlYWRGaWxlLCB3cml0ZUZpbGUgfSBmcm9tIFwibm9kZTpmcy9wcm9taXNlc1wiO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gXCJub2RlOnBhdGhcIjtcbmltcG9ydCB0eXBlIHsgQ29udGV4dENvbmZpZywgTWVtb3J5RW50cnkgfSBmcm9tIFwiLi90eXBlc1wiO1xuaW1wb3J0IHsgREVGQVVMVF9DT05GSUcgfSBmcm9tIFwiLi90eXBlc1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIFZlY3RvckVtYmVkZGluZyB7XG4gICAgaWQ6IHN0cmluZztcbiAgICB2ZWN0b3I6IG51bWJlcltdO1xuICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIG1lbW9yeUlkOiBzdHJpbmc7XG4gICAgICAgIHR5cGU6IHN0cmluZztcbiAgICAgICAgdGFnczogc3RyaW5nW107XG4gICAgICAgIHRpbWVzdGFtcDogc3RyaW5nO1xuICAgIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoUmVzdWx0IHtcbiAgICBtZW1vcnk6IE1lbW9yeUVudHJ5O1xuICAgIHNjb3JlOiBudW1iZXI7XG4gICAgcmVsZXZhbmNlOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmVjdG9yU3RvcmUge1xuICAgIGVtYmVkZGluZ3M6IFZlY3RvckVtYmVkZGluZ1tdO1xuICAgIGRpbWVuc2lvbjogbnVtYmVyO1xuICAgIGluZGV4VHlwZTogXCJmbGF0XCIgfCBcImhuc3dcIiB8IFwiaXZmXCI7XG59XG5cbi8qKlxuICogU2ltcGxlIHRleHQgdG9rZW5pemVyIGZvciBjcmVhdGluZyBlbWJlZGRpbmdzXG4gKi9cbmV4cG9ydCBjbGFzcyBUZXh0VG9rZW5pemVyIHtcbiAgICAvKipcbiAgICAgKiBTaW1wbGUgd29yZC1iYXNlZCB0b2tlbml6YXRpb25cbiAgICAgKi9cbiAgICB0b2tlbml6ZSh0ZXh0OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiB0ZXh0XG4gICAgICAgICAgICAudG9Mb3dlckNhc2UoKVxuICAgICAgICAgICAgLnJlcGxhY2UoL1teXFx3XFxzXS9nLCBcIlwiKVxuICAgICAgICAgICAgLnNwbGl0KC9cXHMrLylcbiAgICAgICAgICAgIC5maWx0ZXIoKHdvcmQpID0+IHdvcmQubGVuZ3RoID4gMCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIFRGLUlERiB2ZWN0b3JzXG4gICAgICovXG4gICAgY3JlYXRlVEZJREZWZWN0b3IodGV4dHM6IHN0cmluZ1tdKTogTWFwPHN0cmluZywgbnVtYmVyPiB7XG4gICAgICAgIGNvbnN0IGFsbFdvcmRzID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgICAgIGNvbnN0IGRvY3VtZW50czogc3RyaW5nW11bXSA9IFtdO1xuXG4gICAgICAgIGZvciAoY29uc3QgdGV4dCBvZiB0ZXh0cykge1xuICAgICAgICAgICAgY29uc3Qgd29yZHMgPSB0aGlzLnRva2VuaXplKHRleHQpO1xuICAgICAgICAgICAgZG9jdW1lbnRzLnB1c2god29yZHMpO1xuICAgICAgICAgICAgd29yZHMuZm9yRWFjaCgod29yZCkgPT4gYWxsV29yZHMuYWRkKHdvcmQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHdvcmRMaXN0ID0gQXJyYXkuZnJvbShhbGxXb3Jkcyk7XG4gICAgICAgIGNvbnN0IGRvY0ZyZXF1ZW5jeTogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXAoKTtcblxuICAgICAgICAvLyBDYWxjdWxhdGUgSURGXG4gICAgICAgIGZvciAoY29uc3Qgd29yZCBvZiB3b3JkTGlzdCkge1xuICAgICAgICAgICAgY29uc3QgZG9jQ291bnQgPSBkb2N1bWVudHMuZmlsdGVyKChkb2MpID0+XG4gICAgICAgICAgICAgICAgZG9jLmluY2x1ZGVzKHdvcmQpLFxuICAgICAgICAgICAgKS5sZW5ndGg7XG4gICAgICAgICAgICBjb25zdCBpZGYgPSBNYXRoLmxvZyh0ZXh0cy5sZW5ndGggLyAoZG9jQ291bnQgKyAxKSk7XG4gICAgICAgICAgICBkb2NGcmVxdWVuY3kuc2V0KHdvcmQsIGlkZik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDYWxjdWxhdGUgVEYtSURGIGZvciB0aGlzIHRleHRcbiAgICAgICAgY29uc3QgdmVjdG9yID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgY29uc3Qgd29yZHMgPSB0aGlzLnRva2VuaXplKHRleHRzWzBdKTsgLy8gVXNlIGZpcnN0IHRleHQgYXMgcXVlcnlcbiAgICAgICAgY29uc3Qgd29yZENvdW50ID0gd29yZHMubGVuZ3RoO1xuXG4gICAgICAgIGZvciAoY29uc3Qgd29yZCBvZiB3b3Jkcykge1xuICAgICAgICAgICAgY29uc3QgdGYgPSB3b3Jkcy5maWx0ZXIoKHcpID0+IHcgPT09IHdvcmQpLmxlbmd0aCAvIHdvcmRDb3VudDtcbiAgICAgICAgICAgIGNvbnN0IHRmaWRmID0gdGYgKiAoZG9jRnJlcXVlbmN5LmdldCh3b3JkKSB8fCAwKTtcbiAgICAgICAgICAgIHZlY3Rvci5zZXQod29yZCwgdGZpZGYpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZlY3RvcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgc2ltcGxlIGZyZXF1ZW5jeSB2ZWN0b3JcbiAgICAgKi9cbiAgICBjcmVhdGVGcmVxdWVuY3lWZWN0b3IodGV4dDogc3RyaW5nKTogTWFwPHN0cmluZywgbnVtYmVyPiB7XG4gICAgICAgIGNvbnN0IHdvcmRzID0gdGhpcy50b2tlbml6ZSh0ZXh0KTtcbiAgICAgICAgY29uc3QgdmVjdG9yID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgY29uc3QgdG90YWxXb3JkcyA9IHdvcmRzLmxlbmd0aDtcblxuICAgICAgICBmb3IgKGNvbnN0IHdvcmQgb2Ygd29yZHMpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gKHZlY3Rvci5nZXQod29yZCkgfHwgMCkgKyAxO1xuICAgICAgICAgICAgdmVjdG9yLnNldCh3b3JkLCBjb3VudCAvIHRvdGFsV29yZHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZlY3RvcjtcbiAgICB9XG59XG5cbi8qKlxuICogVmVjdG9yIHNpbWlsYXJpdHkgY2FsY3VsYXRpb25zXG4gKi9cbmV4cG9ydCBjbGFzcyBWZWN0b3JNYXRoIHtcbiAgICAvKipcbiAgICAgKiBDb3NpbmUgc2ltaWxhcml0eSBiZXR3ZWVuIHR3byB2ZWN0b3JzXG4gICAgICovXG4gICAgc3RhdGljIGNvc2luZVNpbWlsYXJpdHkoXG4gICAgICAgIHZlYzE6IE1hcDxzdHJpbmcsIG51bWJlcj4sXG4gICAgICAgIHZlYzI6IE1hcDxzdHJpbmcsIG51bWJlcj4sXG4gICAgKTogbnVtYmVyIHtcbiAgICAgICAgY29uc3QgaW50ZXJzZWN0aW9uID0gbmV3IFNldChcbiAgICAgICAgICAgIFsuLi52ZWMxLmtleXMoKV0uZmlsdGVyKCh4KSA9PiB2ZWMyLmhhcyh4KSksXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKGludGVyc2VjdGlvbi5zaXplID09PSAwKSByZXR1cm4gMDtcblxuICAgICAgICBsZXQgZG90UHJvZHVjdCA9IDA7XG4gICAgICAgIGxldCBtYWcxID0gMDtcbiAgICAgICAgbGV0IG1hZzIgPSAwO1xuXG4gICAgICAgIGZvciAoY29uc3Qgd29yZCBvZiBpbnRlcnNlY3Rpb24pIHtcbiAgICAgICAgICAgIGRvdFByb2R1Y3QgKz0gKHZlYzEuZ2V0KHdvcmQpIHx8IDApICogKHZlYzIuZ2V0KHdvcmQpIHx8IDApO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiB2ZWMxLnZhbHVlcygpKSB7XG4gICAgICAgICAgICBtYWcxICs9IHZhbHVlICogdmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHZlYzIudmFsdWVzKCkpIHtcbiAgICAgICAgICAgIG1hZzIgKz0gdmFsdWUgKiB2YWx1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIG1hZzEgPSBNYXRoLnNxcnQobWFnMSk7XG4gICAgICAgIG1hZzIgPSBNYXRoLnNxcnQobWFnMik7XG5cbiAgICAgICAgcmV0dXJuIG1hZzEgPT09IDAgfHwgbWFnMiA9PT0gMCA/IDAgOiBkb3RQcm9kdWN0IC8gKG1hZzEgKiBtYWcyKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFdWNsaWRlYW4gZGlzdGFuY2UgYmV0d2VlbiB0d28gdmVjdG9yc1xuICAgICAqL1xuICAgIHN0YXRpYyBldWNsaWRlYW5EaXN0YW5jZSh2ZWMxOiBudW1iZXJbXSwgdmVjMjogbnVtYmVyW10pOiBudW1iZXIge1xuICAgICAgICBpZiAodmVjMS5sZW5ndGggIT09IHZlYzIubGVuZ3RoKSByZXR1cm4gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZO1xuXG4gICAgICAgIGxldCBzdW0gPSAwO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZlYzEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGRpZmYgPSB2ZWMxW2ldIC0gdmVjMltpXTtcbiAgICAgICAgICAgIHN1bSArPSBkaWZmICogZGlmZjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBNYXRoLnNxcnQoc3VtKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0IE1hcCB0byBhcnJheSBmb3IgY2FsY3VsYXRpb25zXG4gICAgICovXG4gICAgc3RhdGljIG1hcFRvQXJyYXkobWFwOiBNYXA8c3RyaW5nLCBudW1iZXI+LCBkaW1lbnNpb246IG51bWJlcik6IG51bWJlcltdIHtcbiAgICAgICAgY29uc3QgYXJyYXkgPSBuZXcgQXJyYXkoZGltZW5zaW9uKS5maWxsKDApO1xuXG4gICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgZm9yIChjb25zdCBbd29yZCwgdmFsdWVdIG9mIG1hcC5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgIGlmIChpID49IGRpbWVuc2lvbikgYnJlYWs7XG4gICAgICAgICAgICBhcnJheVtpXSA9IHZhbHVlO1xuICAgICAgICAgICAgaSsrO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFycmF5O1xuICAgIH1cbn1cblxuLyoqXG4gKiBFbmhhbmNlZCBNZW1vcnkgTWFuYWdlciB3aXRoIFZlY3RvciBTZWFyY2hcbiAqL1xuZXhwb3J0IGNsYXNzIFZlY3Rvck1lbW9yeU1hbmFnZXIge1xuICAgIHByaXZhdGUgY29uZmlnOiBDb250ZXh0Q29uZmlnO1xuICAgIHByaXZhdGUgdmVjdG9yRGlyOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBzdG9yZTogVmVjdG9yU3RvcmU7XG4gICAgcHJpdmF0ZSB0b2tlbml6ZXI6IFRleHRUb2tlbml6ZXI7XG5cbiAgICBjb25zdHJ1Y3Rvcihjb25maWc6IFBhcnRpYWw8Q29udGV4dENvbmZpZz4gPSB7fSkge1xuICAgICAgICB0aGlzLmNvbmZpZyA9IHsgLi4uREVGQVVMVF9DT05GSUcsIC4uLmNvbmZpZyB9O1xuICAgICAgICB0aGlzLnZlY3RvckRpciA9IGpvaW4odGhpcy5jb25maWcuc3RvcmFnZVBhdGgsIFwidmVjdG9yc1wiKTtcbiAgICAgICAgdGhpcy5zdG9yZSA9IHsgZW1iZWRkaW5nczogW10sIGRpbWVuc2lvbjogMCwgaW5kZXhUeXBlOiBcImZsYXRcIiB9O1xuICAgICAgICB0aGlzLnRva2VuaXplciA9IG5ldyBUZXh0VG9rZW5pemVyKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZSB2ZWN0b3Igc3RvcmFnZVxuICAgICAqL1xuICAgIGFzeW5jIGluaXRpYWxpemUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IG1rZGlyKHRoaXMudmVjdG9yRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkVmVjdG9yU3RvcmUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMb2FkIGV4aXN0aW5nIHZlY3RvciBzdG9yZVxuICAgICAqL1xuICAgIHByaXZhdGUgYXN5bmMgbG9hZFZlY3RvclN0b3JlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBzdG9yZVBhdGggPSBqb2luKHRoaXMudmVjdG9yRGlyLCBcInN0b3JlLmpzb25cIik7XG5cbiAgICAgICAgaWYgKGV4aXN0c1N5bmMoc3RvcmVQYXRoKSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgcmVhZEZpbGUoc3RvcmVQYXRoLCBcInV0Zi04XCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcmUgPSBKU09OLnBhcnNlKGNvbnRlbnQpIGFzIFZlY3RvclN0b3JlO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgdmVjdG9yIHN0b3JlOlwiLCBlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTYXZlIHZlY3RvciBzdG9yZVxuICAgICAqL1xuICAgIHByaXZhdGUgYXN5bmMgc2F2ZVZlY3RvclN0b3JlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBzdG9yZVBhdGggPSBqb2luKHRoaXMudmVjdG9yRGlyLCBcInN0b3JlLmpzb25cIik7XG4gICAgICAgIGF3YWl0IHdyaXRlRmlsZShzdG9yZVBhdGgsIEpTT04uc3RyaW5naWZ5KHRoaXMuc3RvcmUsIG51bGwsIDIpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgZW1iZWRkaW5nIGZvciBhIG1lbW9yeSBlbnRyeVxuICAgICAqL1xuICAgIGFzeW5jIGNyZWF0ZUVtYmVkZGluZyhtZW1vcnk6IE1lbW9yeUVudHJ5KTogUHJvbWlzZTxWZWN0b3JFbWJlZGRpbmc+IHtcbiAgICAgICAgLy8gVXNlIFRGLUlERiBmb3Igbm93IChjb3VsZCBiZSB1cGdyYWRlZCB0byBleHRlcm5hbCBlbWJlZGRpbmdzKVxuICAgICAgICBjb25zdCB2ZWN0b3IgPSB0aGlzLnRva2VuaXplci5jcmVhdGVGcmVxdWVuY3lWZWN0b3IobWVtb3J5LmNvbnRlbnQpO1xuICAgICAgICBjb25zdCB2ZWN0b3JBcnJheSA9IFZlY3Rvck1hdGgubWFwVG9BcnJheShcbiAgICAgICAgICAgIHZlY3RvcixcbiAgICAgICAgICAgIHRoaXMuc3RvcmUuZGltZW5zaW9uIHx8IDEwMCxcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCBlbWJlZGRpbmc6IFZlY3RvckVtYmVkZGluZyA9IHtcbiAgICAgICAgICAgIGlkOiBgdmVjXyR7RGF0ZS5ub3coKS50b1N0cmluZygzNil9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDgpfWAsXG4gICAgICAgICAgICB2ZWN0b3I6IHZlY3RvckFycmF5LFxuICAgICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgICAgICBtZW1vcnlJZDogbWVtb3J5LmlkLFxuICAgICAgICAgICAgICAgIHR5cGU6IG1lbW9yeS50eXBlLFxuICAgICAgICAgICAgICAgIHRhZ3M6IG1lbW9yeS50YWdzLFxuICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbWVtb3J5LnByb3ZlbmFuY2UudGltZXN0YW1wLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBVcGRhdGUgc3RvcmUgZGltZW5zaW9uIGlmIG5lZWRlZFxuICAgICAgICBpZiAodGhpcy5zdG9yZS5kaW1lbnNpb24gPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuc3RvcmUuZGltZW5zaW9uID0gdmVjdG9yQXJyYXkubGVuZ3RoO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGVtYmVkZGluZztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGQgbWVtb3J5IHdpdGggdmVjdG9yIGVtYmVkZGluZ1xuICAgICAqL1xuICAgIGFzeW5jIGFkZE1lbW9yeVdpdGhWZWN0b3IobWVtb3J5OiBNZW1vcnlFbnRyeSk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBlbWJlZGRpbmcgPSBhd2FpdCB0aGlzLmNyZWF0ZUVtYmVkZGluZyhtZW1vcnkpO1xuICAgICAgICB0aGlzLnN0b3JlLmVtYmVkZGluZ3MucHVzaChlbWJlZGRpbmcpO1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVWZWN0b3JTdG9yZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlbWFudGljIHNlYXJjaCBmb3IgbWVtb3JpZXNcbiAgICAgKi9cbiAgICBhc3luYyBzZW1hbnRpY1NlYXJjaChcbiAgICAgICAgcXVlcnk6IHN0cmluZyxcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgbGltaXQ/OiBudW1iZXI7XG4gICAgICAgICAgICBtaW5TY29yZT86IG51bWJlcjtcbiAgICAgICAgICAgIG1lbW9yeVR5cGU/OiBzdHJpbmc7XG4gICAgICAgICAgICB0YWdzPzogc3RyaW5nW107XG4gICAgICAgIH0gPSB7fSxcbiAgICApOiBQcm9taXNlPFNlYXJjaFJlc3VsdFtdPiB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5VmVjdG9yID0gdGhpcy50b2tlbml6ZXIuY3JlYXRlRnJlcXVlbmN5VmVjdG9yKHF1ZXJ5KTtcbiAgICAgICAgY29uc3QgcXVlcnlBcnJheSA9IFZlY3Rvck1hdGgubWFwVG9BcnJheShcbiAgICAgICAgICAgIHF1ZXJ5VmVjdG9yLFxuICAgICAgICAgICAgdGhpcy5zdG9yZS5kaW1lbnNpb24sXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0czogU2VhcmNoUmVzdWx0W10gPSBbXTtcblxuICAgICAgICBmb3IgKGNvbnN0IGVtYmVkZGluZyBvZiB0aGlzLnN0b3JlLmVtYmVkZGluZ3MpIHtcbiAgICAgICAgICAgIC8vIEZpbHRlciBieSBtZW1vcnkgdHlwZSBpZiBzcGVjaWZpZWRcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBvcHRpb25zLm1lbW9yeVR5cGUgJiZcbiAgICAgICAgICAgICAgICBlbWJlZGRpbmcubWV0YWRhdGEudHlwZSAhPT0gb3B0aW9ucy5tZW1vcnlUeXBlXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRmlsdGVyIGJ5IHRhZ3MgaWYgc3BlY2lmaWVkXG4gICAgICAgICAgICBpZiAob3B0aW9ucy50YWdzICYmIG9wdGlvbnMudGFncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaGFzVGFnID0gb3B0aW9ucy50YWdzLnNvbWUoKHRhZykgPT5cbiAgICAgICAgICAgICAgICAgICAgZW1iZWRkaW5nLm1ldGFkYXRhLnRhZ3MuaW5jbHVkZXModGFnKSxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGlmICghaGFzVGFnKSBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHNpbWlsYXJpdHlcbiAgICAgICAgICAgIGNvbnN0IHNpbWlsYXJpdHkgPSBWZWN0b3JNYXRoLmNvc2luZVNpbWlsYXJpdHkoXG4gICAgICAgICAgICAgICAgbmV3IE1hcChPYmplY3QuZW50cmllcyhxdWVyeVZlY3RvcikpLFxuICAgICAgICAgICAgICAgIG5ldyBNYXAoXG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b2tlbml6ZXIuY3JlYXRlRnJlcXVlbmN5VmVjdG9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlY29uc3RydWN0IGNvbnRlbnQgZnJvbSBtZXRhZGF0YSAoc2ltcGxpZmllZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWJlZGRpbmcubWV0YWRhdGEubWVtb3J5SWQgfHwgXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmIChzaW1pbGFyaXR5ID49IChvcHRpb25zLm1pblNjb3JlIHx8IDAuMSkpIHtcbiAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzY29yZTogc2ltaWxhcml0eSxcbiAgICAgICAgICAgICAgICAgICAgcmVsZXZhbmNlOiB0aGlzLmdldFJlbGV2YW5jZUxhYmVsKHNpbWlsYXJpdHkpLFxuICAgICAgICAgICAgICAgICAgICBtZW1vcnk6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBlbWJlZGRpbmcubWV0YWRhdGEubWVtb3J5SWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBlbWJlZGRpbmcubWV0YWRhdGEudHlwZSBhcyBhbnksXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBcIlwiLCAvLyBXb3VsZCBuZWVkIHRvIGJlIGxvYWRlZCBmcm9tIG1lbW9yeSBzdG9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvdmVuYW5jZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogXCJ1c2VyXCIgYXMgYW55LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogZW1iZWRkaW5nLm1ldGFkYXRhLnRpbWVzdGFtcCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWRlbmNlOiAxLjAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dDogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWdzOiBlbWJlZGRpbmcubWV0YWRhdGEudGFncyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RBY2Nlc3NlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXNzQ291bnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTb3J0IGJ5IHJlbGV2YW5jZSBzY29yZVxuICAgICAgICByZXN1bHRzLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKTtcblxuICAgICAgICByZXR1cm4gcmVzdWx0cy5zbGljZSgwLCBvcHRpb25zLmxpbWl0IHx8IDEwKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgcmVsZXZhbmNlIGxhYmVsIGZvciBzY29yZVxuICAgICAqL1xuICAgIHByaXZhdGUgZ2V0UmVsZXZhbmNlTGFiZWwoc2NvcmU6IG51bWJlcik6IHN0cmluZyB7XG4gICAgICAgIGlmIChzY29yZSA+PSAwLjgpIHJldHVybiBcIlZlcnkgSGlnaFwiO1xuICAgICAgICBpZiAoc2NvcmUgPj0gMC42KSByZXR1cm4gXCJIaWdoXCI7XG4gICAgICAgIGlmIChzY29yZSA+PSAwLjQpIHJldHVybiBcIk1lZGl1bVwiO1xuICAgICAgICBpZiAoc2NvcmUgPj0gMC4yKSByZXR1cm4gXCJMb3dcIjtcbiAgICAgICAgcmV0dXJuIFwiVmVyeSBMb3dcIjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdmVjdG9yIHN0b3JlIHN0YXRpc3RpY3NcbiAgICAgKi9cbiAgICBnZXRTdGF0cygpOiB7XG4gICAgICAgIHRvdGFsRW1iZWRkaW5nczogbnVtYmVyO1xuICAgICAgICBkaW1lbnNpb246IG51bWJlcjtcbiAgICAgICAgaW5kZXhUeXBlOiBzdHJpbmc7XG4gICAgICAgIGF2ZXJhZ2VWZWN0b3JOb3JtOiBudW1iZXI7XG4gICAgfSB7XG4gICAgICAgIGNvbnN0IG5vcm1zID0gdGhpcy5zdG9yZS5lbWJlZGRpbmdzLm1hcCgoZSkgPT5cbiAgICAgICAgICAgIE1hdGguc3FydChlLnZlY3Rvci5yZWR1Y2UoKHN1bSwgdmFsKSA9PiBzdW0gKyB2YWwgKiB2YWwsIDApKSxcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdG90YWxFbWJlZGRpbmdzOiB0aGlzLnN0b3JlLmVtYmVkZGluZ3MubGVuZ3RoLFxuICAgICAgICAgICAgZGltZW5zaW9uOiB0aGlzLnN0b3JlLmRpbWVuc2lvbixcbiAgICAgICAgICAgIGluZGV4VHlwZTogdGhpcy5zdG9yZS5pbmRleFR5cGUsXG4gICAgICAgICAgICBhdmVyYWdlVmVjdG9yTm9ybTpcbiAgICAgICAgICAgICAgICBub3Jtcy5yZWR1Y2UoKHN1bSwgbm9ybSkgPT4gc3VtICsgbm9ybSwgMCkgLyBub3Jtcy5sZW5ndGgsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVidWlsZCB2ZWN0b3IgaW5kZXggKGZvciBwZXJmb3JtYW5jZSBvcHRpbWl6YXRpb24pXG4gICAgICovXG4gICAgYXN5bmMgcmVidWlsZEluZGV4KCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlJlYnVpbGRpbmcgdmVjdG9yIGluZGV4Li4uXCIpO1xuXG4gICAgICAgIC8vIEZvciBub3csIGp1c3QgZW5zdXJlIGVtYmVkZGluZ3MgYXJlIHNvcnRlZFxuICAgICAgICB0aGlzLnN0b3JlLmVtYmVkZGluZ3Muc29ydCgoYSwgYikgPT5cbiAgICAgICAgICAgIGEubWV0YWRhdGEubWVtb3J5SWQubG9jYWxlQ29tcGFyZShiLm1ldGFkYXRhLm1lbW9yeUlkKSxcbiAgICAgICAgKTtcblxuICAgICAgICBhd2FpdCB0aGlzLnNhdmVWZWN0b3JTdG9yZSgpO1xuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgIGBSZWJ1aWx0IGluZGV4IHdpdGggJHt0aGlzLnN0b3JlLmVtYmVkZGluZ3MubGVuZ3RofSBlbWJlZGRpbmdzYCxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFeHBvcnQgdmVjdG9yIGRhdGEgZm9yIGJhY2t1cFxuICAgICAqL1xuICAgIGFzeW5jIGV4cG9ydFZlY3RvcnMoZm9ybWF0OiBcImpzb25cIiB8IFwiY3N2XCIgPSBcImpzb25cIik6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGlmIChmb3JtYXQgPT09IFwianNvblwiKSB7XG4gICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcy5zdG9yZSwgbnVsbCwgMik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDU1YgZXhwb3J0XG4gICAgICAgIGNvbnN0IGhlYWRlcnMgPSBbXG4gICAgICAgICAgICBcImlkXCIsXG4gICAgICAgICAgICBcIm1lbW9yeUlkXCIsXG4gICAgICAgICAgICBcInR5cGVcIixcbiAgICAgICAgICAgIFwidGFnc1wiLFxuICAgICAgICAgICAgXCJ0aW1lc3RhbXBcIixcbiAgICAgICAgICAgIFwiZGltZW5zaW9uXCIsXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IHJvd3MgPSB0aGlzLnN0b3JlLmVtYmVkZGluZ3MubWFwKChlKSA9PiBbXG4gICAgICAgICAgICBlLmlkLFxuICAgICAgICAgICAgZS5tZXRhZGF0YS5tZW1vcnlJZCxcbiAgICAgICAgICAgIGUubWV0YWRhdGEudHlwZSxcbiAgICAgICAgICAgIGUubWV0YWRhdGEudGFncy5qb2luKFwiO1wiKSxcbiAgICAgICAgICAgIGUubWV0YWRhdGEudGltZXN0YW1wLFxuICAgICAgICAgICAgZS52ZWN0b3IubGVuZ3RoLFxuICAgICAgICBdKTtcblxuICAgICAgICByZXR1cm4gW2hlYWRlcnMuam9pbihcIixcIiksIC4uLnJvd3MubWFwKChyb3cpID0+IHJvdy5qb2luKFwiLFwiKSldLmpvaW4oXG4gICAgICAgICAgICBcIlxcblwiLFxuICAgICAgICApO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDb250ZXh0IFJhbmtpbmcgRW5naW5lXG4gKi9cbmV4cG9ydCBjbGFzcyBDb250ZXh0UmFua2VyIHtcbiAgICAvKipcbiAgICAgKiBSYW5rIG1lbW9yaWVzIGJ5IHJlbGV2YW5jZSB0byBjdXJyZW50IGNvbnRleHRcbiAgICAgKi9cbiAgICBzdGF0aWMgcmFua0J5UmVsZXZhbmNlKFxuICAgICAgICBtZW1vcmllczogTWVtb3J5RW50cnlbXSxcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgcXVlcnk/OiBzdHJpbmc7XG4gICAgICAgICAgICBhY3RpdmVGaWxlcz86IHN0cmluZ1tdO1xuICAgICAgICAgICAgY3VycmVudFRhc2s/OiBzdHJpbmc7XG4gICAgICAgICAgICBzZXNzaW9uVHlwZT86IHN0cmluZztcbiAgICAgICAgfSxcbiAgICApOiBNZW1vcnlFbnRyeVtdIHtcbiAgICAgICAgY29uc3Qgc2NvcmVkID0gbWVtb3JpZXMubWFwKChtZW1vcnkpID0+IHtcbiAgICAgICAgICAgIGxldCBzY29yZSA9IDA7XG5cbiAgICAgICAgICAgIC8vIFF1ZXJ5IHJlbGV2YW5jZVxuICAgICAgICAgICAgaWYgKGNvbnRleHQucXVlcnkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBxdWVyeVdvcmRzID0gY29udGV4dC5xdWVyeS50b0xvd2VyQ2FzZSgpLnNwbGl0KC9cXHMrLyk7XG4gICAgICAgICAgICAgICAgY29uc3QgY29udGVudFdvcmRzID0gbWVtb3J5LmNvbnRlbnQudG9Mb3dlckNhc2UoKS5zcGxpdCgvXFxzKy8pO1xuICAgICAgICAgICAgICAgIGNvbnN0IG92ZXJsYXAgPSBxdWVyeVdvcmRzLmZpbHRlcigod29yZCkgPT5cbiAgICAgICAgICAgICAgICAgICAgY29udGVudFdvcmRzLmluY2x1ZGVzKHdvcmQpLFxuICAgICAgICAgICAgICAgICkubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHNjb3JlICs9IChvdmVybGFwIC8gcXVlcnlXb3Jkcy5sZW5ndGgpICogMC40O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBGaWxlIHJlbGV2YW5jZVxuICAgICAgICAgICAgaWYgKGNvbnRleHQuYWN0aXZlRmlsZXMgJiYgY29udGV4dC5hY3RpdmVGaWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsZU1lbnRpb24gPSBjb250ZXh0LmFjdGl2ZUZpbGVzLnNvbWUoKGZpbGUpID0+XG4gICAgICAgICAgICAgICAgICAgIG1lbW9yeS5jb250ZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoZmlsZS50b0xvd2VyQ2FzZSgpKSxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGlmIChmaWxlTWVudGlvbikgc2NvcmUgKz0gMC4zO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBUYXNrIHJlbGV2YW5jZVxuICAgICAgICAgICAgaWYgKGNvbnRleHQuY3VycmVudFRhc2spIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0YXNrUmVsZXZhbmNlID0gbWVtb3J5LmNvbnRlbnRcbiAgICAgICAgICAgICAgICAgICAgLnRvTG93ZXJDYXNlKClcbiAgICAgICAgICAgICAgICAgICAgLmluY2x1ZGVzKGNvbnRleHQuY3VycmVudFRhc2sudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgICAgICAgICAgaWYgKHRhc2tSZWxldmFuY2UpIHNjb3JlICs9IDAuMjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUmVjZW5jeSBib29zdFxuICAgICAgICAgICAgY29uc3QgZGF5c1NpbmNlQWNjZXNzID1cbiAgICAgICAgICAgICAgICAoRGF0ZS5ub3coKSAtIG5ldyBEYXRlKG1lbW9yeS5sYXN0QWNjZXNzZWQpLmdldFRpbWUoKSkgL1xuICAgICAgICAgICAgICAgICgxMDAwICogNjAgKiA2MCAqIDI0KTtcbiAgICAgICAgICAgIGNvbnN0IHJlY2VuY3lTY29yZSA9IE1hdGgubWF4KDAsIDEgLSBkYXlzU2luY2VBY2Nlc3MgLyAzMCk7IC8vIERlY2F5IG92ZXIgMzAgZGF5c1xuICAgICAgICAgICAgc2NvcmUgKz0gcmVjZW5jeVNjb3JlICogMC4xO1xuXG4gICAgICAgICAgICAvLyBDb25maWRlbmNlIGJvb3N0XG4gICAgICAgICAgICBzY29yZSArPSBtZW1vcnkucHJvdmVuYW5jZS5jb25maWRlbmNlICogMC4xO1xuXG4gICAgICAgICAgICByZXR1cm4geyBtZW1vcnksIHNjb3JlIH07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNvcnQgYnkgc2NvcmVcbiAgICAgICAgc2NvcmVkLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKTtcblxuICAgICAgICByZXR1cm4gc2NvcmVkLm1hcCgoaXRlbSkgPT4gaXRlbS5tZW1vcnkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBleHBsYW5hdGlvbiBmb3IgcmFua2luZ1xuICAgICAqL1xuICAgIHN0YXRpYyBnZXRSYW5raW5nRXhwbGFuYXRpb24obWVtb3J5OiBNZW1vcnlFbnRyeSwgc2NvcmU6IG51bWJlcik6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IGZhY3RvcnMgPSBbXTtcblxuICAgICAgICBpZiAoc2NvcmUgPiAwLjUpIGZhY3RvcnMucHVzaChcIkhpZ2ggcmVsZXZhbmNlIHRvIHF1ZXJ5XCIpO1xuICAgICAgICBpZiAobWVtb3J5LnByb3ZlbmFuY2UuY29uZmlkZW5jZSA+IDAuOCkgZmFjdG9ycy5wdXNoKFwiSGlnaCBjb25maWRlbmNlXCIpO1xuICAgICAgICBpZiAobWVtb3J5LnRhZ3MuaW5jbHVkZXMoXCJyZWNlbnRcIikpIGZhY3RvcnMucHVzaChcIlJlY2VudGx5IGFjY2Vzc2VkXCIpO1xuICAgICAgICBpZiAobWVtb3J5LmFjY2Vzc0NvdW50ID4gNSkgZmFjdG9ycy5wdXNoKFwiRnJlcXVlbnRseSBhY2Nlc3NlZFwiKTtcblxuICAgICAgICByZXR1cm4gZmFjdG9ycy5sZW5ndGggPiAwID8gZmFjdG9ycy5qb2luKFwiLCBcIikgOiBcIkJhc2UgcmVsZXZhbmNlXCI7XG4gICAgfVxufVxuIiwKICAgICIvKipcbiAqIENvbnRleHQgRW5naW5lZXJpbmcgVHlwZSBEZWZpbml0aW9uc1xuICpcbiAqIENvcmUgdHlwZXMgZm9yIHNlc3Npb24gbWFuYWdlbWVudCwgbWVtb3J5IHN5c3RlbSwgYW5kIHByb2dyZXNzaXZlIGRpc2Nsb3N1cmUuXG4gKiBCYXNlZCBvbiByZXNlYXJjaCBmcm9tIEdvb2dsZSdzIENvbnRleHQgRW5naW5lZXJpbmcgYW5kIENsYXVkZSBTa2lsbHMgcGF0dGVybnMuXG4gKi9cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gU2Vzc2lvbiBUeXBlc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlc3Npb24ge1xuICAgIGlkOiBzdHJpbmc7XG4gICAgcGFyZW50SUQ/OiBzdHJpbmc7IC8vIFBhcmVudCBzZXNzaW9uIElEIGZvciBuZXN0ZWQgc3ViYWdlbnQgY2FsbHNcbiAgICBjcmVhdGVkQXQ6IHN0cmluZzsgLy8gSVNPIGRhdGUgc3RyaW5nXG4gICAgbGFzdEFjdGl2ZTogc3RyaW5nOyAvLyBJU08gZGF0ZSBzdHJpbmdcbiAgICB3b3JrYmVuY2g6IFNlc3Npb25Xb3JrYmVuY2g7XG4gICAgbWV0YWRhdGE6IFNlc3Npb25NZXRhZGF0YTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZXNzaW9uV29ya2JlbmNoIHtcbiAgICAvKiogQ3VycmVudGx5IGFjdGl2ZS9vcGVuIGZpbGVzIGluIHRoZSBzZXNzaW9uICovXG4gICAgYWN0aXZlRmlsZXM6IHN0cmluZ1tdO1xuICAgIC8qKiBQZW5kaW5nIHRhc2tzIHRyYWNrZWQgaW4gdGhpcyBzZXNzaW9uICovXG4gICAgcGVuZGluZ1Rhc2tzOiBUYXNrW107XG4gICAgLyoqIEFyY2hpdGVjdHVyYWwvZGVzaWduIGRlY2lzaW9ucyBtYWRlICovXG4gICAgZGVjaXNpb25zOiBEZWNpc2lvbltdO1xuICAgIC8qKiBBcmJpdHJhcnkgY29udGV4dCBkYXRhICovXG4gICAgY29udGV4dDogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2Vzc2lvbk1ldGFkYXRhIHtcbiAgICAvKiogUHJvamVjdCBuYW1lIG9yIHBhdGggKi9cbiAgICBwcm9qZWN0OiBzdHJpbmc7XG4gICAgLyoqIEdpdCBicmFuY2ggaWYgYXBwbGljYWJsZSAqL1xuICAgIGJyYW5jaD86IHN0cmluZztcbiAgICAvKiogQ3VycmVudCB3b3JraW5nIG1vZGUgKi9cbiAgICBtb2RlPzogXCJwbGFuXCIgfCBcImJ1aWxkXCIgfCBcInJldmlld1wiO1xuICAgIC8qKiBQbGF0Zm9ybSBiZWluZyB1c2VkICovXG4gICAgcGxhdGZvcm0/OiBcImNsYXVkZS1jb2RlXCIgfCBcIm9wZW5jb2RlXCI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGFzayB7XG4gICAgaWQ6IHN0cmluZztcbiAgICBjb250ZW50OiBzdHJpbmc7XG4gICAgc3RhdHVzOiBcInBlbmRpbmdcIiB8IFwiaW5fcHJvZ3Jlc3NcIiB8IFwiY29tcGxldGVkXCIgfCBcImNhbmNlbGxlZFwiO1xuICAgIHByaW9yaXR5OiBcImxvd1wiIHwgXCJtZWRpdW1cIiB8IFwiaGlnaFwiO1xuICAgIGNyZWF0ZWRBdDogc3RyaW5nO1xuICAgIGNvbXBsZXRlZEF0Pzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIERlY2lzaW9uIHtcbiAgICBpZDogc3RyaW5nO1xuICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICByYXRpb25hbGU6IHN0cmluZztcbiAgICBhbHRlcm5hdGl2ZXM/OiBzdHJpbmdbXTtcbiAgICBjcmVhdGVkQXQ6IHN0cmluZztcbiAgICB0YWdzOiBzdHJpbmdbXTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTWVtb3J5IFR5cGVzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCB0eXBlIE1lbW9yeVR5cGUgPSBcImRlY2xhcmF0aXZlXCIgfCBcInByb2NlZHVyYWxcIiB8IFwiZXBpc29kaWNcIjtcbmV4cG9ydCB0eXBlIE1lbW9yeVNvdXJjZSA9IFwidXNlclwiIHwgXCJhZ2VudFwiIHwgXCJpbmZlcnJlZFwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1lbW9yeUVudHJ5IHtcbiAgICBpZDogc3RyaW5nO1xuICAgIHR5cGU6IE1lbW9yeVR5cGU7XG4gICAgY29udGVudDogc3RyaW5nO1xuICAgIHByb3ZlbmFuY2U6IE1lbW9yeVByb3ZlbmFuY2U7XG4gICAgdGFnczogc3RyaW5nW107XG4gICAgbGFzdEFjY2Vzc2VkOiBzdHJpbmc7XG4gICAgYWNjZXNzQ291bnQ6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNZW1vcnlQcm92ZW5hbmNlIHtcbiAgICAvKiogV2hlcmUgdGhpcyBtZW1vcnkgY2FtZSBmcm9tICovXG4gICAgc291cmNlOiBNZW1vcnlTb3VyY2U7XG4gICAgLyoqIFdoZW4gdGhpcyB3YXMgcmVjb3JkZWQgKi9cbiAgICB0aW1lc3RhbXA6IHN0cmluZztcbiAgICAvKiogQ29uZmlkZW5jZSBsZXZlbCAwLTEgKGRlY2F5cyBvdmVyIHRpbWUgZm9yIGluZmVycmVkKSAqL1xuICAgIGNvbmZpZGVuY2U6IG51bWJlcjtcbiAgICAvKiogQ29udGV4dCBpbiB3aGljaCB0aGlzIHdhcyBsZWFybmVkICovXG4gICAgY29udGV4dDogc3RyaW5nO1xuICAgIC8qKiBSZWxhdGVkIHNlc3Npb24gSUQgaWYgYXBwbGljYWJsZSAqL1xuICAgIHNlc3Npb25JZD86IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNZW1vcnlTdG9yZSB7XG4gICAgLyoqIEZhY3RzLCBwYXR0ZXJucywgcHJlZmVyZW5jZXMgKi9cbiAgICBkZWNsYXJhdGl2ZTogTWVtb3J5RW50cnlbXTtcbiAgICAvKiogV29ya2Zsb3dzLCBwcm9jZWR1cmVzLCBoYWJpdHMgKi9cbiAgICBwcm9jZWR1cmFsOiBNZW1vcnlFbnRyeVtdO1xuICAgIC8qKiBDb252ZXJzYXRpb24gc3VtbWFyaWVzLCBwYXN0IGV2ZW50cyAqL1xuICAgIGVwaXNvZGljOiBNZW1vcnlFbnRyeVtdO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBQcm9ncmVzc2l2ZSBEaXNjbG9zdXJlIFR5cGVzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCB0eXBlIFNraWxsVGllciA9IDEgfCAyIHwgMztcblxuZXhwb3J0IGludGVyZmFjZSBTa2lsbE1ldGFkYXRhIHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICB0aWVyOiBTa2lsbFRpZXI7XG4gICAgY2FwYWJpbGl0aWVzOiBzdHJpbmdbXTtcbiAgICBwYXRoOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2tpbGxDb250ZW50IHtcbiAgICBtZXRhZGF0YTogU2tpbGxNZXRhZGF0YTtcbiAgICAvKiogVGllciAxOiBBbHdheXMgbG9hZGVkIG92ZXJ2aWV3ICovXG4gICAgb3ZlcnZpZXc6IHN0cmluZztcbiAgICAvKiogVGllciAyOiBMb2FkZWQgb24gYWN0aXZhdGlvbiAqL1xuICAgIGluc3RydWN0aW9ucz86IHN0cmluZztcbiAgICAvKiogVGllciAzOiBMb2FkZWQgb24gc3BlY2lmaWMgbmVlZCAqL1xuICAgIHJlc291cmNlcz86IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBMb2FkZWRTa2lsbCB7XG4gICAgbWV0YWRhdGE6IFNraWxsTWV0YWRhdGE7XG4gICAgbG9hZGVkVGllcnM6IFNraWxsVGllcltdO1xuICAgIGNvbnRlbnQ6IHN0cmluZztcbiAgICB0b2tlbkVzdGltYXRlOiBudW1iZXI7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIENvbnRleHQgUmV0cmlldmFsIFR5cGVzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCB0eXBlIFJldHJpZXZhbFBhdHRlcm4gPSBcInB1c2hcIiB8IFwicHVsbFwiIHwgXCJoeWJyaWRcIjtcblxuZXhwb3J0IGludGVyZmFjZSBDb250ZXh0VHJpZ2dlciB7XG4gICAgdHlwZTpcbiAgICAgICAgfCBcInNlc3Npb25fc3RhcnRcIlxuICAgICAgICB8IFwiZmlsZV9vcGVuXCJcbiAgICAgICAgfCBcImNvbW1hbmRcIlxuICAgICAgICB8IFwicXVlcnlcIlxuICAgICAgICB8IFwidGFza1wiXG4gICAgICAgIHwgXCJjb252ZXJzYXRpb25fdHVyblwiXG4gICAgICAgIHwgXCJmaWxlX2VkaXRcIjtcbiAgICBwYXR0ZXJuOiBSZXRyaWV2YWxQYXR0ZXJuO1xuICAgIGRhdGE6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFzc2VtYmxlZENvbnRleHQge1xuICAgIC8qKiBTZXNzaW9uIHN0YXRlICovXG4gICAgc2Vzc2lvbj86IFNlc3Npb247XG4gICAgLyoqIFJlbGV2YW50IG1lbW9yaWVzICovXG4gICAgbWVtb3JpZXM6IE1lbW9yeUVudHJ5W107XG4gICAgLyoqIExvYWRlZCBza2lsbHMgKi9cbiAgICBza2lsbHM6IExvYWRlZFNraWxsW107XG4gICAgLyoqIFRvdGFsIHRva2VuIGVzdGltYXRlICovXG4gICAgdG9rZW5Fc3RpbWF0ZTogbnVtYmVyO1xuICAgIC8qKiBBc3NlbWJseSBtZXRhZGF0YSAqL1xuICAgIG1ldGE6IHtcbiAgICAgICAgYXNzZW1ibGVkQXQ6IHN0cmluZztcbiAgICAgICAgdHJpZ2dlcnM6IHN0cmluZ1tdO1xuICAgICAgICBkdXJhdGlvbjogbnVtYmVyO1xuICAgIH07XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIENvbmZpZ3VyYXRpb24gVHlwZXNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBDb250ZXh0RXhwb3J0Q29uZmlnIHtcbiAgICAvKiogRW5hYmxlIGV4cG9ydGluZyBodW1hbi1yZWFkYWJsZSBjb21tYW5kIGVudmVsb3Blcy4gKi9cbiAgICBlbmFibGVkPzogYm9vbGVhbjtcbiAgICAvKiogTWFya2Rvd24gZXhwb3J0IHNldHRpbmdzICovXG4gICAgbWFya2Rvd24/OiB7XG4gICAgICAgIC8qKiBPdXRwdXQgZGlyZWN0b3J5IGZvciBtYXJrZG93biBleHBvcnRzICovXG4gICAgICAgIG91dHB1dERpcj86IHN0cmluZztcbiAgICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbnRleHRDb25maWcge1xuICAgIC8qKiBQYXRoIHRvIGNvbnRleHQgc3RvcmFnZSBkaXJlY3RvcnkgKi9cbiAgICBzdG9yYWdlUGF0aDogc3RyaW5nO1xuICAgIC8qKiBNYXhpbXVtIG1lbW9yaWVzIHRvIGtlZXAgcGVyIHR5cGUgKi9cbiAgICBtYXhNZW1vcmllc1BlclR5cGU6IG51bWJlcjtcbiAgICAvKiogRGF5cyBiZWZvcmUgYXJjaGl2aW5nIG9sZCBzZXNzaW9ucyAqL1xuICAgIHNlc3Npb25BcmNoaXZlRGF5czogbnVtYmVyO1xuICAgIC8qKiBDb25maWRlbmNlIGRlY2F5IHJhdGUgZm9yIGluZmVycmVkIG1lbW9yaWVzIChwZXIgZGF5KSAqL1xuICAgIGNvbmZpZGVuY2VEZWNheVJhdGU6IG51bWJlcjtcbiAgICAvKiogRW5hYmxlIHZlY3RvciBlbWJlZGRpbmdzIChyZXF1aXJlcyBleHRlcm5hbCBBUEkpICovXG4gICAgZW5hYmxlRW1iZWRkaW5nczogYm9vbGVhbjtcbiAgICAvKiogRGVmYXVsdCBza2lsbCB0aWVyIHRvIGxvYWQgKi9cbiAgICBkZWZhdWx0U2tpbGxUaWVyOiBTa2lsbFRpZXI7XG4gICAgLyoqIEVuYWJsZSBhdXRvbWF0aWMgY29udGV4dCBpbmZlcmVuY2UgZnJvbSBjb252ZXJzYXRpb25zIGFuZCBhY3Rpb25zICovXG4gICAgZW5hYmxlQXV0b0luZmVyZW5jZTogYm9vbGVhbjtcbiAgICAvKiogT3B0aW9uYWwgaHVtYW4tcmVhZGFibGUgZXhwb3J0cyAqL1xuICAgIGV4cG9ydD86IENvbnRleHRFeHBvcnRDb25maWc7XG59XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX0NPTkZJRzogQ29udGV4dENvbmZpZyA9IHtcbiAgICBzdG9yYWdlUGF0aDogXCIuYWktY29udGV4dFwiLFxuICAgIG1heE1lbW9yaWVzUGVyVHlwZTogMTAwLFxuICAgIHNlc3Npb25BcmNoaXZlRGF5czogMzAsXG4gICAgY29uZmlkZW5jZURlY2F5UmF0ZTogMC4wNSxcbiAgICBlbmFibGVFbWJlZGRpbmdzOiBmYWxzZSxcbiAgICBkZWZhdWx0U2tpbGxUaWVyOiAxLFxuICAgIGVuYWJsZUF1dG9JbmZlcmVuY2U6IHRydWUsIC8vIEVuYWJsZSBhdXRvbWF0aWMgaW5mZXJlbmNlIGJ5IGRlZmF1bHRcbiAgICBleHBvcnQ6IHtcbiAgICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgICAgIG1hcmtkb3duOiB7XG4gICAgICAgICAgICBvdXRwdXREaXI6IFwiLmFpLWNvbnRleHQvZXhwb3J0c1wiLFxuICAgICAgICB9LFxuICAgIH0sXG59O1xuXG4vKipcbiAqIExvYWQgY29uZmlndXJhdGlvbiBmcm9tIC5haS1jb250ZXh0L2NvbmZpZy5qc29uIGlmIGl0IGV4aXN0c1xuICovXG5mdW5jdGlvbiBtZXJnZUNvbnRleHRDb25maWcoXG4gICAgYmFzZTogQ29udGV4dENvbmZpZyxcbiAgICBvdmVycmlkZXM/OiBQYXJ0aWFsPENvbnRleHRDb25maWc+LFxuKTogQ29udGV4dENvbmZpZyB7XG4gICAgY29uc3QgbWVyZ2VkOiBDb250ZXh0Q29uZmlnID0ge1xuICAgICAgICAuLi5iYXNlLFxuICAgICAgICAuLi5vdmVycmlkZXMsXG4gICAgICAgIGV4cG9ydDoge1xuICAgICAgICAgICAgLi4uYmFzZS5leHBvcnQsXG4gICAgICAgICAgICAuLi5vdmVycmlkZXM/LmV4cG9ydCxcbiAgICAgICAgICAgIG1hcmtkb3duOiB7XG4gICAgICAgICAgICAgICAgLi4uYmFzZS5leHBvcnQ/Lm1hcmtkb3duLFxuICAgICAgICAgICAgICAgIC4uLm92ZXJyaWRlcz8uZXhwb3J0Py5tYXJrZG93bixcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgfTtcblxuICAgIHJldHVybiBtZXJnZWQ7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2FkQ29uZmlnKFxuICAgIGN1c3RvbUNvbmZpZz86IFBhcnRpYWw8Q29udGV4dENvbmZpZz4sXG4pOiBQcm9taXNlPENvbnRleHRDb25maWc+IHtcbiAgICAvLyBNZXJnZSBkZWZhdWx0cyArIHBhc3NlZCBjb25maWcgZmlyc3QgKHNvIHN0b3JhZ2VQYXRoIGNhbiBpbmZsdWVuY2Ugd2hlcmUgY29uZmlnLmpzb24gaXMpLlxuICAgIGNvbnN0IGJhc2VDb25maWcgPSBtZXJnZUNvbnRleHRDb25maWcoREVGQVVMVF9DT05GSUcsIGN1c3RvbUNvbmZpZyk7XG5cbiAgICB0cnkge1xuICAgICAgICAvLyBUcnkgdG8gbG9hZCBwcm9qZWN0LXNwZWNpZmljIGNvbmZpZ1xuICAgICAgICBjb25zdCB7IHJlYWRGaWxlIH0gPSBhd2FpdCBpbXBvcnQoXCJub2RlOmZzL3Byb21pc2VzXCIpO1xuICAgICAgICBjb25zdCB7IGV4aXN0c1N5bmMgfSA9IGF3YWl0IGltcG9ydChcIm5vZGU6ZnNcIik7XG4gICAgICAgIGNvbnN0IHsgam9pbiB9ID0gYXdhaXQgaW1wb3J0KFwibm9kZTpwYXRoXCIpO1xuXG4gICAgICAgIGNvbnN0IGNvbmZpZ1BhdGggPSBqb2luKGJhc2VDb25maWcuc3RvcmFnZVBhdGgsIFwiY29uZmlnLmpzb25cIik7XG4gICAgICAgIGlmIChleGlzdHNTeW5jKGNvbmZpZ1BhdGgpKSB7XG4gICAgICAgICAgICBjb25zdCBjb25maWdDb250ZW50ID0gYXdhaXQgcmVhZEZpbGUoY29uZmlnUGF0aCwgXCJ1dGYtOFwiKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2plY3RDb25maWcgPSBKU09OLnBhcnNlKFxuICAgICAgICAgICAgICAgIGNvbmZpZ0NvbnRlbnQsXG4gICAgICAgICAgICApIGFzIFBhcnRpYWw8Q29udGV4dENvbmZpZz47XG4gICAgICAgICAgICByZXR1cm4gbWVyZ2VDb250ZXh0Q29uZmlnKGJhc2VDb25maWcsIHByb2plY3RDb25maWcpO1xuICAgICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgLy8gSWdub3JlIGNvbmZpZyBsb2FkaW5nIGVycm9ycywgdXNlIGRlZmF1bHRzXG4gICAgICAgIGNvbnN0IHNpbGVudCA9XG4gICAgICAgICAgICBwcm9jZXNzLmVudi5BSV9FTkdfU0lMRU5UID09PSBcIjFcIiB8fFxuICAgICAgICAgICAgcHJvY2Vzcy5lbnYuQUlfRU5HX1NJTEVOVCA9PT0gXCJ0cnVlXCIgfHxcbiAgICAgICAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcInRlc3RcIiB8fFxuICAgICAgICAgICAgcHJvY2Vzcy5lbnYuQlVOX1RFU1QgPT09IFwiMVwiIHx8XG4gICAgICAgICAgICBwcm9jZXNzLmVudi5CVU5fVEVTVCA9PT0gXCJ0cnVlXCI7XG5cbiAgICAgICAgaWYgKCFzaWxlbnQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgICAgICBcIkNvdWxkIG5vdCBsb2FkIGNvbnRleHQgY29uZmlnLCB1c2luZyBkZWZhdWx0czpcIixcbiAgICAgICAgICAgICAgICBlcnJvcixcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYmFzZUNvbmZpZztcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ29tbWFuZCBFbnZlbG9wZSBUeXBlc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgdHlwZSBDb21tYW5kRXhlY3V0aW9uU3RhdHVzID0gXCJzdWNjZXNzXCIgfCBcImZhaWx1cmVcIjtcblxuZXhwb3J0IGludGVyZmFjZSBDb21tYW5kQ29udGV4dEVudmVsb3BlIHtcbiAgICAvKiogVW5pcXVlIGlkIGZvciB0aGlzIGVudmVsb3BlICovXG4gICAgaWQ6IHN0cmluZztcbiAgICAvKiogSVNPIHRpbWVzdGFtcCAqL1xuICAgIGNyZWF0ZWRBdDogc3RyaW5nO1xuICAgIC8qKiBDTEkgY29tbWFuZCBuYW1lIChlLmcuICdwbGFuJywgJ3Jlc2VhcmNoJykgKi9cbiAgICBjb21tYW5kTmFtZTogc3RyaW5nO1xuICAgIC8qKiBTdWNjZXNzL2ZhaWx1cmUgKi9cbiAgICBzdGF0dXM6IENvbW1hbmRFeGVjdXRpb25TdGF0dXM7XG4gICAgLyoqIER1cmF0aW9uIGluIG1pbGxpc2Vjb25kcyAqL1xuICAgIGR1cmF0aW9uTXM6IG51bWJlcjtcblxuICAgIC8qKiBCZXN0LWVmZm9ydCBpbnB1dHMvb3B0aW9ucy9hcmdzIHN1bW1hcnkgKi9cbiAgICBpbnB1dHM/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcblxuICAgIC8qKiBIdW1hbi1yZWFkYWJsZSBzaG9ydCBzdW1tYXJ5IG9mIHdoYXQgaGFwcGVuZWQgKi9cbiAgICBvdXRwdXRTdW1tYXJ5Pzogc3RyaW5nO1xuXG4gICAgLyoqIEJlc3QtZWZmb3J0IGxpc3Qgb2YgZmlsZXMgdGhlIGNvbW1hbmQgd3JvdGUvbW9kaWZpZWQgKG1heSBiZSBlbXB0eSkgKi9cbiAgICBmaWxlc1RvdWNoZWQ/OiBzdHJpbmdbXTtcblxuICAgIC8qKiBEZWNpc2lvbnMgY2FwdHVyZWQgZHVyaW5nIGV4ZWN1dGlvbiAqL1xuICAgIGRlY2lzaW9ucz86IHN0cmluZ1tdO1xuXG4gICAgLyoqIFRhZ3MgZm9yIHJldHJpZXZhbCAqL1xuICAgIHRhZ3M6IHN0cmluZ1tdO1xuXG4gICAgLyoqIE9wdGlvbmFsIHNlc3Npb24gaWRlbnRpZmllciAqL1xuICAgIHNlc3Npb25JZD86IHN0cmluZztcblxuICAgIC8qKiBPcHRpb25hbCBwcm9qZWN0IGlkZW50aWZpZXIgKHBhdGgvcmVwbyBuYW1lKSAqL1xuICAgIHByb2plY3Q/OiBzdHJpbmc7XG5cbiAgICAvKiogRXJyb3IgZGV0YWlscyAob25seSB3aGVuIHN0YXR1cyA9PT0gJ2ZhaWx1cmUnKSAqL1xuICAgIGVycm9yPzoge1xuICAgICAgICBtZXNzYWdlOiBzdHJpbmc7XG4gICAgICAgIG5hbWU/OiBzdHJpbmc7XG4gICAgICAgIHN0YWNrPzogc3RyaW5nO1xuICAgIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVDb21tYW5kRW52ZWxvcGUoaW5wdXQ6IHtcbiAgICBjb21tYW5kTmFtZTogc3RyaW5nO1xuICAgIHN0YXR1czogQ29tbWFuZEV4ZWN1dGlvblN0YXR1cztcbiAgICBzdGFydFRpbWVNczogbnVtYmVyO1xuICAgIGVuZFRpbWVNczogbnVtYmVyO1xuICAgIGlucHV0cz86IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgIG91dHB1dFN1bW1hcnk/OiBzdHJpbmc7XG4gICAgZmlsZXNUb3VjaGVkPzogc3RyaW5nW107XG4gICAgZGVjaXNpb25zPzogc3RyaW5nW107XG4gICAgdGFncz86IHN0cmluZ1tdO1xuICAgIHNlc3Npb25JZD86IHN0cmluZztcbiAgICBwcm9qZWN0Pzogc3RyaW5nO1xuICAgIGVycm9yPzogdW5rbm93bjtcbn0pOiBDb21tYW5kQ29udGV4dEVudmVsb3BlIHtcbiAgICBjb25zdCBjcmVhdGVkQXQgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgY29uc3QgaWQgPSBgZW52XyR7RGF0ZS5ub3coKS50b1N0cmluZygzNil9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDgpfWA7XG5cbiAgICBsZXQgZXJyb3JQYXlsb2FkOiBDb21tYW5kQ29udGV4dEVudmVsb3BlW1wiZXJyb3JcIl07XG4gICAgaWYgKGlucHV0LmVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgZXJyb3JQYXlsb2FkID0ge1xuICAgICAgICAgICAgbWVzc2FnZTogaW5wdXQuZXJyb3IubWVzc2FnZSxcbiAgICAgICAgICAgIG5hbWU6IGlucHV0LmVycm9yLm5hbWUsXG4gICAgICAgICAgICBzdGFjazogaW5wdXQuZXJyb3Iuc3RhY2ssXG4gICAgICAgIH07XG4gICAgfSBlbHNlIGlmIChpbnB1dC5lcnJvcikge1xuICAgICAgICBlcnJvclBheWxvYWQgPSB7XG4gICAgICAgICAgICBtZXNzYWdlOiBTdHJpbmcoaW5wdXQuZXJyb3IpLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICBjcmVhdGVkQXQsXG4gICAgICAgIGNvbW1hbmROYW1lOiBpbnB1dC5jb21tYW5kTmFtZSxcbiAgICAgICAgc3RhdHVzOiBpbnB1dC5zdGF0dXMsXG4gICAgICAgIGR1cmF0aW9uTXM6IE1hdGgubWF4KDAsIGlucHV0LmVuZFRpbWVNcyAtIGlucHV0LnN0YXJ0VGltZU1zKSxcbiAgICAgICAgaW5wdXRzOiBpbnB1dC5pbnB1dHMsXG4gICAgICAgIG91dHB1dFN1bW1hcnk6IGlucHV0Lm91dHB1dFN1bW1hcnksXG4gICAgICAgIGZpbGVzVG91Y2hlZDogaW5wdXQuZmlsZXNUb3VjaGVkIHx8IFtdLFxuICAgICAgICBkZWNpc2lvbnM6IGlucHV0LmRlY2lzaW9ucyB8fCBbXSxcbiAgICAgICAgdGFnczogQXJyYXkuZnJvbShcbiAgICAgICAgICAgIG5ldyBTZXQoW1xuICAgICAgICAgICAgICAgIFwiY29tbWFuZC1lbnZlbG9wZVwiLFxuICAgICAgICAgICAgICAgIGBjb21tYW5kOiR7aW5wdXQuY29tbWFuZE5hbWV9YCxcbiAgICAgICAgICAgICAgICAuLi4oaW5wdXQudGFncyB8fCBbXSksXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgKSxcbiAgICAgICAgc2Vzc2lvbklkOiBpbnB1dC5zZXNzaW9uSWQsXG4gICAgICAgIHByb2plY3Q6IGlucHV0LnByb2plY3QsXG4gICAgICAgIGVycm9yOiBpbnB1dC5zdGF0dXMgPT09IFwiZmFpbHVyZVwiID8gZXJyb3JQYXlsb2FkIDogdW5kZWZpbmVkLFxuICAgIH07XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEV2ZW50IFR5cGVzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCB0eXBlIENvbnRleHRFdmVudCA9XG4gICAgfCB7IHR5cGU6IFwic2Vzc2lvbl9jcmVhdGVkXCI7IHNlc3Npb246IFNlc3Npb24gfVxuICAgIHwgeyB0eXBlOiBcInNlc3Npb25fcmVzdG9yZWRcIjsgc2Vzc2lvbjogU2Vzc2lvbiB9XG4gICAgfCB7IHR5cGU6IFwic2Vzc2lvbl91cGRhdGVkXCI7IHNlc3Npb246IFNlc3Npb24gfVxuICAgIHwgeyB0eXBlOiBcIm1lbW9yeV9hZGRlZFwiOyBlbnRyeTogTWVtb3J5RW50cnkgfVxuICAgIHwgeyB0eXBlOiBcIm1lbW9yeV9hY2Nlc3NlZFwiOyBlbnRyeTogTWVtb3J5RW50cnkgfVxuICAgIHwgeyB0eXBlOiBcInNraWxsX2xvYWRlZFwiOyBza2lsbDogTG9hZGVkU2tpbGwgfVxuICAgIHwgeyB0eXBlOiBcImNvbnRleHRfYXNzZW1ibGVkXCI7IGNvbnRleHQ6IEFzc2VtYmxlZENvbnRleHQgfTtcblxuZXhwb3J0IHR5cGUgQ29udGV4dEV2ZW50SGFuZGxlciA9IChldmVudDogQ29udGV4dEV2ZW50KSA9PiB2b2lkIHwgUHJvbWlzZTx2b2lkPjtcbiIKICBdLAogICJtYXBwaW5ncyI6ICI7QUFPQTtBQUNBO0FBQ0E7OztBQytMTyxJQUFNLGlCQUFnQztBQUFBLEVBQ3pDLGFBQWE7QUFBQSxFQUNiLG9CQUFvQjtBQUFBLEVBQ3BCLG9CQUFvQjtBQUFBLEVBQ3BCLHFCQUFxQjtBQUFBLEVBQ3JCLGtCQUFrQjtBQUFBLEVBQ2xCLGtCQUFrQjtBQUFBLEVBQ2xCLHFCQUFxQjtBQUFBLEVBQ3JCLFFBQVE7QUFBQSxJQUNKLFNBQVM7QUFBQSxJQUNULFVBQVU7QUFB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LFFBQzdELE1BQU0sVUFBVSxXQUFXLE9BQU8sQ0FBQyxTQUMvQixhQUFhLFNBQVMsSUFBSSxDQUM5QixFQUFFO0FBQUEsUUFDRixTQUFVLFVBQVUsV0FBVyxTQUFVO0FBQUEsTUFDN0M7QUFBQSxNQUdBLElBQUksUUFBUSxlQUFlLFFBQVEsWUFBWSxTQUFTLEdBQUc7QUFBQSxRQUN2RCxNQUFNLGNBQWMsUUFBUSxZQUFZLEtBQUssQ0FBQyxTQUMxQyxPQUFPLFFBQVEsWUFBWSxFQUFFLFNBQVMsS0FBSyxZQUFZLENBQUMsQ0FDNUQ7QUFBQSxRQUNBLElBQUk7QUFBQSxVQUFhLFNBQVM7QUFBQSxNQUM5QjtBQUFBLE1BR0EsSUFBSSxRQUFRLGFBQWE7QUFBQSxRQUNyQixNQUFNLGdCQUFnQixPQUFPLFFBQ3hCLFlBQVksRUFDWixTQUFTLFFBQVEsWUFBWSxZQUFZLENBQUM7QUFBQSxRQUMvQyxJQUFJO0FBQUEsVUFBZSxTQUFTO0FBQUEsTUFDaEM7QUFBQSxNQUdBLE1BQU0sbUJBQ0QsS0FBSyxJQUFJLElBQUksSUFBSSxLQUFLLE9BQU8sWUFBWSxFQUFFLFFBQVEsTUFDbkQsT0FBTyxLQUFLLEtBQUs7QUFBQSxNQUN0QixNQUFNLGVBQWUsS0FBSyxJQUFJLEdBQUcsSUFBSSxrQkFBa0IsRUFBRTtBQUFBLE1BQ3pELFNBQVMsZUFBZTtBQUFBLE1BR3hCLFNBQVMsT0FBTyxXQUFXLGFBQWE7QUFBQSxNQUV4QyxPQUFPLEVBQUUsUUFBUSxNQUFNO0FBQUEsS0FDMUI7QUFBQSxJQUdELE9BQU8sS0FBSyxDQUFDLEdBQUcsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFLO0FBQUEsSUFFdkMsT0FBTyxPQUFPLElBQUksQ0FBQyxTQUFTLEtBQUssTUFBTTtBQUFBO0FBQUEsU0FNcEMscUJBQXFCLENBQUMsUUFBcUIsT0FBdUI7QUFBQSxJQUNyRSxNQUFNLFVBQVUsQ0FBQztBQUFBLElBRWpCLElBQUksUUFBUTtBQUFBLE1BQUssUUFBUSxLQUFLLHlCQUF5QjtBQUFBLElBQ3ZELElBQUksT0FBTyxXQUFXLGFBQWE7QUFBQSxNQUFLLFFBQVEsS0FBSyxpQkFBaUI7QUFBQSxJQUN0RSxJQUFJLE9BQU8sS0FBSyxTQUFTLFFBQVE7QUFBQSxNQUFHLFFBQVEsS0FBSyxtQkFBbUI7QUFBQSxJQUNwRSxJQUFJLE9BQU8sY0FBYztBQUFBLE1BQUcsUUFBUSxLQUFLLHFCQUFxQjtBQUFBLElBRTlELE9BQU8sUUFBUSxTQUFTLElBQUksUUFBUSxLQUFLLElBQUksSUFBSTtBQUFBO0FBRXpEOyIsCiAgImRlYnVnSWQiOiAiMUUyRDcxQkYyOEY1MjJERjY0NzU2RTIxNjQ3NTZFMjEiLAogICJuYW1lcyI6IFtdCn0=
