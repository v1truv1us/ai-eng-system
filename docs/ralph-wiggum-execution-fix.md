# Ralph Wiggum Command Execution Issue - Fix Summary

## Date
January 9, 2026

## Problem

The `ralph-wiggum` command (and 4 other workflow commands) contained an erroneous "Execution" section at the end of the markdown files that referenced a non-existent script:

```bash
bun run scripts/run-command.ts ralph-wiggum "feature description" [options]
```

**Impact:**
1. The AI reads this and may attempt to run an external script instead of following the markdown instructions directly
2. Confuses the execution model - these are **prompt instructions**, not CLI scripts
3. The `scripts/run-command.ts` file never existed

## Root Cause

The "Execution" section was likely auto-generated by the command-creator agent or similar tools, assuming all commands needed an external runner script. This was incorrect for prompt-based commands that are self-executing by the AI.

## Files Fixed

### Primary Source Files (plugins/ai-eng-system/commands/)

1. **ralph-wiggum.md**
   - Removed erroneous "Execution" section (lines 777-789)
   - Added "How This Command Works" section after line 67

2. **work.md**
   - Removed erroneous "Execution" section (lines 583-594)

3. **specify.md**
   - Removed erroneous "Execution" section (lines 298-308)

4. **plan.md**
   - Removed erroneous "Execution" section (lines 500-510)

5. **review.md**
   - Removed erroneous "Execution" section (lines 122-132)

### Secondary Files (content/commands/)

All 5 commands were also fixed in the content/commands/ directory, which is used as the canonical source for the build process.

### Output Locations

After running `bun run build`, the fixes were propagated to:
- `.claude/commands/` - Claude Code local runtime
- `.claude-plugin/commands/` - Claude Code plugin output (for CI/tests)
- `.opencode/command/ai-eng/` - OpenCode local runtime
- `dist/.claude-plugin/commands/` - npm package distribution for Claude Code

All output locations verified to have no erroneous "## Execution" sections with "bun run scripts/run-command.ts" references.

## Changes Made

### ralph-wiggum.md (Primary Fix)

**Added Section: "How This Command Works" (after Quick Start, line 68)**

```markdown
## How This Command Works

This command is a **self-orchestrating prompt** - when you invoke `/ai-eng/ralph-wiggum`, the AI reads these instructions and executes each phase directly within the conversation.

**Execution Model:**
1. **NOT a CLI script** - There is no external runner. The AI IS the executor.
2. **Phase commands are internal** - When instructions say "Execute `/ai-eng/research`", the AI follows that command's instructions directly (not spawning a subprocess).
3. **Continuous flow** - The AI proceeds through all phases autonomously unless checkpoints are set.

**To run this command:**
- Claude Code: Type `/ai-eng/ralph-wiggum "your feature description"`
- OpenCode: Type `/ai-eng/ralph-wiggum "your feature description"`

The AI will then follow all phases in this document from start to finish.
```

**Removed Section: "## Execution" (was lines 777-789)**

Removed this entire section:
```markdown
## Execution

After creating this command, the agent can invoke it with:

```bash
bun run scripts/run-command.ts ralph-wiggum "feature description" [options]
```

Examples:
- `bun run scripts/run-command.ts ralph-wiggum "implement user auth" --checkpoint=all --verbose`
- `bun run scripts/run-command.ts ralph-wiggum "API caching" --from-spec=specs/cache/spec.md --resume`

After completing the full cycle, rate your confidence in feature completeness and quality (0.0-1.0). Identify any uncertainties about phase transitions, iterations that were inefficient, or areas where quality gates may have been too lenient or strict. Note any workflow improvements that could enhance future cycles.
```

### Other Commands (work.md, specify.md, plan.md, review.md)

For these 4 commands, simply removed the erroneous "## Execution" sections at the end of each file.

## Why This Fix Works

The fix addresses both parts of the issue:

### Part A: Remove Misleading Information
- Eliminates confusion about external script execution
- Prevents AI from trying to run non-existent `bun run scripts/run-command.ts`
- Clears up the command structure

### Part B: Add Explicit Self-Orchestration Instructions
- Makes it clear that the AI executes the phases directly
- Explains the execution model (prompt-based, not script-based)
- Provides clear guidance on how to invoke the command
- Documents that phase commands are internal invocations, not subprocesses

## Verification

All output locations verified:
- ✅ No "## Execution" sections found in any command file
- ✅ No "bun run scripts/run-command.ts" references in any command file
- ✅ "How This Command Works" section present in ralph-wiggum.md (line 68)
- ✅ Build validation passes
- ✅ Source files clean (no erroneous references)

## Testing Recommendation

To verify the fix works correctly:

1. **Test ralph-wiggum command:**
   ```bash
   /ai-eng/ralph-wiggum "test feature with continuous iteration"
   ```
   The AI should now:
   - Read the "How This Command Works" section and understand it's self-executing
   - Proceed through all phases (Research → Specify → Plan → Work → Review) autonomously
   - NOT try to run an external script

2. **Test other workflow commands:**
   ```bash
   /ai-eng/work "test plan"
   /ai-eng/specify "test specification"
   /ai-eng/plan "test planning"
   /ai-eng/review "test review"
   ```
   All should execute correctly without trying to call non-existent scripts.

3. **Verify continuous phase execution:**
   The AI should continue through all phases without stopping between them (unless `--checkpoint` flag is set).

## Preventive Measures

### For Future Command Creation

1. **Never add "## Execution" sections** that reference non-existent scripts
2. **Commands should be self-documenting** - They are prompt instructions, not CLI wrappers
3. **If special execution is needed, document it in the workflow section** not at the end
4. **Use "Integration" sections** to show how commands connect, not how they're executed

### Template Update

The `agents/command-creator.md` agent should be updated to:
- Not include "## Execution" sections with `bun run scripts/run-command.ts` patterns
- Provide correct examples that show direct command invocation
- Document that commands are prompt-based, not script-based

## Build Process

The build script (`build.ts`) correctly:
1. Copies from `content/commands/` to all output locations
2. Validates generated files
3. Builds npm entrypoint

After fixing the source files, running `bun run build` propagated all changes to:
- `.claude/commands/`
- `.claude-plugin/commands/`
- `.opencode/command/ai-eng/`
- `dist/.claude-plugin/commands/`

## Summary

✅ **Fixed 5 commands** (ralph-wiggum, work, specify, plan, review)
✅ **Added clear execution model** for ralph-wiggum
✅ **Removed all misleading script references**
✅ **Verified propagation to all output locations**
✅ **Build validation passes**

The ralph-wiggum command and other workflow commands will now execute correctly through all phases without attempting to run non-existent external scripts.
